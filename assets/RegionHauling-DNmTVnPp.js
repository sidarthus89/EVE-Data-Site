import{j as e}from"./index-CGeEUy5P.js";import{r as t}from"./react-vendor-qWGkjVPF.js";import{h as r,R as n,g as s,i,j as a,k as l}from"./common-BOMxUclB.js";import{c as o}from"./market-CPjWOgLq.js";const c=(e,t=2)=>{if(null==e||isNaN(e))return"0";return parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})},u={fromRegion:null,toRegion:null,nearbyOnly:!1,minProfit:"500000",maxWeight:"",minROI:4,maxJumps:"",maxBudget:"",salesTax:7.5,securityStatus:"any",structureType:"both",routePreference:"safest",hideOutOfStock:!1};function m(){const[m,d]=t.useState(u),[h,p]=t.useState(null),[y,g]=t.useState(null),[f,x]=t.useState(!1),[b,j]=t.useState([]),[v,N]=t.useState(null),[P,_]=t.useState(!1),[k,S]=t.useState([]),[I,w]=t.useState(1),[R]=t.useState(50),[C,T]=t.useState(!1),[F,D]=t.useState(!1),[J,O]=t.useState({key:null,direction:"asc"}),[B,M]=t.useState(!1),A=async e=>{try{const t=await l(`https://esi.evetech.net/latest/universe/types/${e}/`);return{volume:t.volume||.01,name:t.name||`Item ${e}`}}catch(t){return{volume:.01,name:`Item ${e}`}}},U=async(e,t)=>{try{const r="shortest"===m.routePreference?"shortest":"secure";return(await l(`https://esi.evetech.net/latest/route/${e}/${t}/?flag=${r}`)).length-1}catch(r){return"N/A"}};t.useEffect(()=>{const e=()=>{const e=document.querySelector(".hauling-form");if(e){const t=e.getBoundingClientRect(),r=60;T(t.top<=r)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const $=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){}};t.useEffect(()=>{r().then(e=>{p(e)}).catch(e=>{N("Failed to load regions data")})},[]);const L=t.useMemo(()=>h?h.map(e=>({regionID:e.region_id||e.regionID,regionName:e.region_name||e.regionName||e.name,...e})):[],[h]);t.useEffect(()=>{m.fromRegion&&L.length,S([])},[m.fromRegion,L]),t.useEffect(()=>{m.nearbyOnly&&k.length>0?d(e=>({...e,toRegion:{regionID:"nearby",regionName:`${k.length} Nearby Regions`}})):m.nearbyOnly||"nearby"!==m.toRegion?.regionID||d(e=>({...e,toRegion:null}))},[m.nearbyOnly,k]);const V=(e,t)=>{d(r=>({...r,[e]:t||("minProfit"===e?"500000":r[e])}))},E=async(e,t,r)=>{try{const n=(await o(e,t)).filter(e=>{const t=e.profit_per_unit??e.buy_price-e.sell_price??0,n=e.max_volume??0,s=e.total_profit??t*n,i=e.profit_margin??(e.sell_price?t/e.sell_price*100:0),a=s>=parseFloat(r.minProfit||0),l=(e.sell_price??0)*n,o=!r.maxBudget||l<=parseFloat(r.maxBudget);return a&&i>=parseFloat(r.minROI||0)&&o});return await(async(e,t)=>{const[r,n]=await Promise.all([i(),a()]),s=new Map(n.map(e=>[Number(e.station_id||e.stationID),e])),l=new Map(r.map(e=>[Number(e.structureID??e.stationID),e]));if(!e||!Array.isArray(e))return[];const o=t.maxWeight?parseFloat(t.maxWeight):null,c=[];for(const i of e){const e=await A(i.type_id);let t=i.max_volume||0;if(o&&e.volume>0){const r=Math.floor(o/e.volume);t=Math.min(t,r)}const r=Math.floor(t*e.volume);let n,a,u,m,d,h=null,p=null;if(i.origin_name&&i.destination_name)n=i.origin_name,a=i.destination_name,u=i.origin_is_npc??!0,m=i.destination_is_npc??!0,d=i.jumps??"N/A";else{const e=i.origin_id??i.from_location??i.source_station_id,t=i.destination_id??i.to_location??i.destination_station_id;h=s.get(e)||l.get(e)||{},p=s.get(t)||l.get(t)||{},h.name,p.name,n=h.name||`Unknown Station (ID: ${e})`,a=p.name||`Unknown Station (ID: ${t})`,u="station"===h.type||1===h.is_npc,m="station"===p.type||1===p.is_npc,d="N/A";const r=i.origin_system_id||h?.system_id||h?.systemID||h?.solarSystemID,o=i.destination_system_id||p?.system_id||p?.systemID||p?.solarSystemID;r&&o&&(d=await U(r,o))}let y=i.origin_security??(h?h.security_status??h.security??null:null),g=i.destination_security??(p?p.security_status??p.security??null:null);y=null!=y?Number(y):y,g=null!=g?Number(g):g;const f=i.profit_per_jump??(d&&"number"==typeof d&&d>0?(i.profit_per_unit||0)*t/d:null);c.push({Item:i.name||e.name,From:{name:n,security:y,isNPC:u,systemId:i.origin_system_id||(h?h.system_id:null)},To:{name:a,security:g,isNPC:m,systemId:i.destination_system_id||(p?p.system_id:null)},"Buy Price":i.sell_price||0,"Sell Price":i.buy_price||0,"Profit Per Unit":i.profit_per_unit||0,"Profit Percentage":i.profit_margin||0,Quantity:t,"Total Volume (m3)":i.total_volume||r,"Item Volume":i.volume||e.volume,Jumps:d,"Profit per Jump":f,"Total Profit":i.total_profit||(i.profit_per_unit||0)*t,ROI:i.profit_margin,_rawData:i})}let u=c;if(t.securityStatus&&"any"!==t.securityStatus){const e=e=>"number"==typeof e&&e>=.5,r=e=>"number"==typeof e&&e>0&&e<.5,n=e=>"number"==typeof e&&e<=0;u=u.filter(s=>{const i=s.From?.security,a=s.To?.security;return null!=i&&null!=a&&("highsec"===t.securityStatus?e(i)&&e(a):"lowsec"===t.securityStatus?r(i)&&r(a):"nullsec"!==t.securityStatus||n(i)&&n(a))})}if(t.structureType&&"both"!==t.structureType&&(u=u.filter(e=>{const r=!!e.From?.isNPC,n=!!e.To?.isNPC;return"stations"===t.structureType?r&&n:"structures"!==t.structureType||!r&&!n})),t.maxJumps){const e=Number(t.maxJumps);Number.isFinite(e)&&(u=u.filter(t=>"number"!=typeof t.Jumps||t.Jumps<=e))}return u})(n,r)}catch(n){throw new Error("Failed to fetch market orders.")}},Q=e=>{O(t=>t.key===e?{key:e,direction:"asc"===t.direction?"desc":"asc"}:{key:e,direction:"asc"})},W=t.useMemo(()=>{if(!J.key)return b;const e=[...b];return e.sort((e,t)=>{const r=(e,t)=>{switch(t){case"Item":return e.Item||"";case"From":return e.From&&e.From.name||e.From||"";case"To":return e.To&&e.To.name||e["Take To"]||"";case"Quantity":return e.Quantity||0;case"Buy Price":return e["Buy Price"]||0;case"Total Buy Price":return(e["Buy Price"]||0)*(e.Quantity||0);case"Sell Price":return e["Sell Price"]||0;case"Net Profit":return e["Total Profit"]||0;case"Jumps":return"number"==typeof e.Jumps?e.Jumps:0;case"Profit per Jump":return"number"==typeof e.Jumps&&e["Total Profit"]?e["Total Profit"]/e.Jumps:0;case"Profit Per Item":return e["Profit Per Unit"]||0;case"ROI":return e["Profit Percentage"]||0;case"Total Volume (m³)":return e["Total Volume (m3)"]||0;default:return e[t]||""}},n=r(e,J.key),s=r(t,J.key);return"number"==typeof n&&"number"==typeof s?"asc"===J.direction?n-s:s-n:"asc"===J.direction?String(n).localeCompare(String(s)):String(s).localeCompare(String(n))}),e},[b,J]);return h?e.jsxs("div",{className:"region-hauling",children:[e.jsx("div",{className:"static-header",children:e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Region to Region Trading"}),e.jsx("p",{className:"disclaimer",children:"This feature is still a WIP and may have issues."})]})}),e.jsxs("div",{className:"scrollable-content",children:[e.jsx("div",{className:"hauling-form",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),j([]),w(1),x(!0),N(null),M(!1),!m.fromRegion?.regionID||!m.toRegion?.regionID)return N("Please select both source and destination regions"),void x(!1);try{const e=Number(m.fromRegion.regionID),t=Number(m.toRegion.regionID),r=await E(e,t,m);r.length>0?(j(r),_(r.some(e=>e._rawData&&e._rawData._fallback)),M(!0)):N("No profitable trades found for the selected criteria.")}catch(t){N(t.message)}finally{x(!1)}},children:[e.jsx("div",{className:"form-container",children:e.jsxs("div",{className:"form-row form-row-main",style:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"20px",padding:"0 20px",overflowX:"auto",margin:"0 auto 10px auto"},children:[e.jsxs("div",{className:"form-group region-group",children:[e.jsx("label",{children:"Starting Region"}),e.jsx(n,{selectedRegion:m.fromRegion,onRegionChange:e=>{d(t=>({...t,fromRegion:e,nearbyOnly:!(!t.nearbyOnly||!e)&&t.nearbyOnly}))},allowAllRegions:!1})]}),e.jsxs("div",{className:"form-group region-group",children:[e.jsx("label",{children:"Ending Region"}),m.nearbyOnly?e.jsx("div",{className:"nearby-region-display",children:"…"}):e.jsx(n,{selectedRegion:m.toRegion,onRegionChange:e=>{d(t=>({...t,toRegion:e,nearbyOnly:!1}))},allowAllRegions:!1})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Security"}),e.jsx("select",{value:m.securityStatus,onChange:e=>V("securityStatus",e.target.value),className:"form-control",style:{width:"115px"},children:[{value:"any",label:"Any"},{value:"highsec",label:"High-Sec"},{value:"lowsec",label:"Low-Sec"},{value:"nullsec",label:"Null-Sec"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stations/Structures"}),e.jsx("select",{value:m.structureType,onChange:e=>V("structureType",e.target.value),className:"form-control",style:{width:"165px"},children:[{value:"both",label:"Any"},{value:"stations",label:"NPC Stations"},{value:"structures",label:"Player Structures"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Route"}),e.jsx("select",{value:m.routePreference,onChange:e=>V("routePreference",e.target.value),className:"form-control",style:{width:"155px"},children:[{value:"safest",label:"Safest Route"},{value:"shortest",label:"Shortest Route"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Jumps"}),e.jsx("input",{type:"number",value:m.maxJumps,onChange:e=>V("maxJumps",e.target.value),placeholder:"∞",className:"form-control",style:{width:"80px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Budget"}),e.jsx("input",{type:"number",value:m.maxBudget,onChange:e=>V("maxBudget",e.target.value),placeholder:"∞",className:"form-control",style:{width:"165px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Capacity (m³)"}),e.jsx("input",{type:"number",value:m.maxWeight,onChange:e=>V("maxWeight",e.target.value),placeholder:"∞",className:"form-control",style:{width:"135px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sales Tax"}),e.jsx("select",{value:m.salesTax,onChange:e=>V("salesTax",Number(e.target.value)),className:"form-control",style:{width:"155px"},children:[{level:0,tax:7.5,label:"No Skill: 7.5%"},{level:1,tax:6.675,label:"Lvl I: 6.675%"},{level:2,tax:5.85,label:"Lvl II: 5.85%"},{level:3,tax:5.025,label:"Lvl III: 5.025%"},{level:4,tax:4.2,label:"Lvl IV: 4.2%"},{level:5,tax:3.375,label:"Lvl V: 3.375%"}].map(t=>e.jsx("option",{value:t.tax,children:t.label},t.level))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min Profit"}),e.jsx("input",{type:"number",value:m.minProfit,onChange:e=>V("minProfit",e.target.value),className:"form-control",style:{width:"175px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min ROI %"}),e.jsx("input",{type:"number",value:m.minROI,onChange:e=>V("minROI",Number(e.target.value)||0),className:"form-control",style:{width:"100px"}})]})]})}),v&&e.jsx("div",{className:"error-message",children:v}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",disabled:f||!m.fromRegion||!m.toRegion,className:"submit-btn",children:f?"Searching...":"Find Trade Routes"})})]})}),B&&W.length>0&&e.jsxs("div",{className:"results-container",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("h2",{children:["Trade Route Results (",W.length," found)"]}),P&&e.jsx("div",{className:"fallback-warning",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"4px",padding:"10px",margin:"10px 0",color:"#856404"},children:"⚠️ Azure Functions unavailable. Using basic market data analysis. Results may be limited to common trade items."}),e.jsx("button",{onClick:()=>{j([]),N(null),w(1),_(!1),M(!1)},className:"new-search-btn",children:"Clear Results"})]}),e.jsx("div",{className:"results-table-container",children:e.jsxs("table",{className:"results-table wide-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Q("Item"),children:["Item","Item"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("From"),children:["From","From"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Quantity"),children:["Quantity","Quantity"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Buy Price"),children:["Buy Price","Buy Price"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Total Buy Price"),children:["Total Buy","Total Buy Price"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("To"),children:["To","To"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Sell Price"),children:["Sell Price","Sell Price"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Net Profit"),children:["Net Profit","Net Profit"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Jumps"),children:["Jumps","Jumps"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Profit per Jump"),children:["Profit/Jump","Profit per Jump"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Profit Per Item"),children:["Profit/Unit","Profit Per Item"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("ROI"),children:["ROI%","ROI"===J.key?"asc"===J.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Total Volume (m³)"),children:["Volume (m³)","Total Volume (m³)"===J.key?"asc"===J.direction?" ▲":" ▼":""]})]})}),e.jsx("tbody",{children:(()=>{const t=(I-1)*R,r=t+R;return W.slice(t,r).map((r,n)=>{const i=r.Item||"Unknown Item",a=r.From||{},l=r.To||r["Take To"]||{},o=r["Buy Price"]||0,u=r["Sell Price"]||0,m=r["Profit Per Unit"]||0,d=r["Profit Percentage"]||0,h=r["Total Profit"]||0,p=r.Quantity||0,y=r["Total Volume (m3)"]||0,g=r.Jumps||"N/A",f=o*p,x="number"==typeof g&&g>0?h/g:0,b=t=>{if("string"==typeof t)return e.jsx("span",{className:"clickable-location",onClick:()=>$(t),title:"Click to copy to clipboard",children:t});const r=t.name||"Unknown Station",n=t.security,i=t.isNPC;let a="#ffffff";return null!=n&&(a=s(n)),e.jsx("span",{className:"clickable-location",style:{color:a},onClick:()=>$(r),title:`Security: ${null!=n?n.toFixed(1):"Unknown"} | ${i?"NPC Station":"Player Structure"} | Click to copy`,children:r})};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"clickable-location",onClick:()=>$(i),title:"Click to copy item name",children:i})}),e.jsx("td",{children:b(a)}),e.jsx("td",{children:c(p,0)}),e.jsx("td",{children:c(o)}),e.jsx("td",{children:c(f)}),e.jsx("td",{children:b(l)}),e.jsx("td",{children:c(u)}),e.jsx("td",{children:c(h)}),e.jsx("td",{children:g}),e.jsx("td",{children:c(x)}),e.jsx("td",{children:c(m)}),e.jsxs("td",{children:[c(d,1),"%"]}),e.jsx("td",{children:c(y,0)})]},t+n)})})()})]})}),W.length>R&&e.jsx("div",{className:"pagination-container",children:e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>w(e=>Math.max(e-1,1)),disabled:1===I,className:"pagination-btn",children:"Previous"}),e.jsxs("span",{className:"pagination-info",children:["Page ",I," of ",Math.ceil(W.length/R),"(",W.length," total results)"]}),e.jsx("button",{onClick:()=>w(e=>Math.min(e+1,Math.ceil(W.length/R))),disabled:I>=Math.ceil(W.length/R),className:"pagination-btn",children:"Next"})]})})]})]}),e.jsx("div",{className:"return-to-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),title:"Return to Top",children:"↑"})]}):e.jsx("div",{className:"region-hauling",children:e.jsx("div",{className:"loading-container",children:e.jsx("p",{children:"Loading regions..."})})})}export{m as default};

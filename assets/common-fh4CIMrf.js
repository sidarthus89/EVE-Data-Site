import{j as e}from"./index-B_2f2i0E.js";import{r as t}from"./react-vendor-BJsIi5Ft.js";const o=`${"/EVE-Data-Site-Dev/".replace(/\/$/,"")}/data`,r="https://sidarthus89.github.io/EVE-Data-Site/data".replace(/\/$/,"")||o,n=({}.VITE_AZURE_BASE||"https://evedatafunc01.azurewebsites.net/api").replace(/\/$/,""),s="https://esi.evetech.net/latest";async function i(e,t={},o=3){for(let n=0;n<o;n++)try{const o=await fetch(e,t);if(!o.ok){const e=await o.text();throw console.error(`❌ HTTP ${o.status}: ${o.statusText}`,e),new Error(`HTTP ${o.status}: ${o.statusText}`)}const r=o.headers.get("content-type");if(r&&r.includes("application/json"))return await o.json();{const e=await o.text();throw console.error("❌ Non-JSON response:",e),new Error("Response is not JSON")}}catch(r){if(console.error(`❌ Fetch attempt ${n+1} failed:`,r.message),n===o-1)throw r;await new Promise(e=>setTimeout(e,1e3*Math.pow(2,n)))}}async function a(e){let t;for(const r of e.filter(Boolean))try{return await i(r)}catch(o){t=o}throw t||new Error("No sources available")}function c(){return a([`${r}/market.json`,`${r}/market/market.json`])}function l(){return a([`${r}/regions.json`,`${r}/regions/regions.json`]).then(e=>{if(Array.isArray(e))return e;if(e&&Array.isArray(e.regions))return e.regions;throw new Error("Invalid regions.json format")})}function u(){return a([`${r}/structures.json`,`${r}/structures/structures.json`])}function f(){return a([`${r}/stations.json`,`${r}/stations/stations_npc.json`])}async function g(e,t){const o=Number(e),r=Number(t);if(!Number.isFinite(o)||!Number.isFinite(r))throw new Error("invalid-system-ids");const n=`${s}/route/${o}/${r}/`,i=await fetch(n,{headers:{"User-Agent":"EVE-Data-Site"}});if(!i.ok)throw new Error(`ESI route ${i.status}`);const a=await i.json();return Array.isArray(a)?Math.max(0,a.length-1):null}function h(e){const t=String(e);try{const e=`${t}.json`,o=`${n}/log/request?name=${encodeURIComponent(e)}&source=${encodeURIComponent("spa:region_orders")}`;"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon?navigator.sendBeacon(o,"1"):fetch(o,{method:"GET",mode:"no-cors",cache:"no-store",keepalive:!0}).catch(()=>{})}catch{}return fetch(`${r}/region_orders/${t}.json`).then(async e=>{if(!e.ok)throw new Error(`snapshot-missing:${e.status}`);if(!(e.headers.get("content-type")||"").includes("application/json"))throw new Error("snapshot-not-json");return e.json()})}async function p(){const{owner:e,repo:t}=function(){try{const e="sidarthus89",t="EVE-Data-Site",o=o=>{const r=new URL(o),n=r.hostname||"",s=(r.pathname||"/").split("/").filter(Boolean);return n.endsWith("github.io")&&s.length>0?{owner:n.split(".")[0]||e,repo:s[0]||t}:null};if(/^https?:\/\//i.test(r)){const e=o(r);if(e)return e}if("undefined"!=typeof window){const e=o(window.location.href);if(e)return e}return{owner:e,repo:t}}catch{return{owner:"sidarthus89",repo:"EVE-Data-Site"}}}(),o=`https://api.github.com/repos/${e}/${t}/commits?sha=gh-pages&path=data&per_page=1`;try{const e=await fetch(o,{headers:{Accept:"application/vnd.github+json"}});if(e.ok){const t=await e.json(),o=Array.isArray(t)?t[0]:null,r=o?.commit?.committer?.date||o?.commit?.author?.date;if(r)return new Date(r).toISOString()}}catch{}return null}const d=["The Forge","Domain","Heimatar","Sinq Laison","Metropolis"];function m({selectedRegion:o,onRegionChange:r,allowAllRegions:n=!0}){const[s,i]=t.useState([]),[a,c]=t.useState(null),[u,f]=t.useState(!0);t.useEffect(()=>{!async function(){try{const e=await l();if(!e||!Array.isArray(e))throw new Error("Invalid regions data format");const t=19000001,o=e.filter(e=>e.regionID!==t);i(o),c(null),f(!1)}catch(e){console.error("❌ RegionSelector: Failed to load regions:",e),c(`Failed to load regions: ${e.message}`),i([]),f(!1)}}()},[]),t.useEffect(()=>{n&&(!o||!o.regionID)&&s.length>0&&r?.({regionName:"All Regions",regionID:"all"})},[o,s,r,n]);const{popularRegionsList:g,otherRegionsList:h,allRegionsList:p}=t.useMemo(()=>({popularRegionsList:s.filter(e=>d.includes(e.regionName)).sort((e,t)=>e.regionName.localeCompare(t.regionName)),otherRegionsList:s.filter(e=>!d.includes(e.regionName)).sort((e,t)=>e.regionName.localeCompare(t.regionName)),allRegionsList:s.slice().sort((e,t)=>e.regionName.localeCompare(t.regionName))}),[s]);if(a)return console.error("❌ RegionSelector error:",a),e.jsxs("div",{style:{color:"red",padding:"1rem"},children:["Error loading regions: ",a]});if(0===s.length){const t=u?"Loading regions...":"Discovering regions from market data...";return e.jsx("div",{style:{padding:"1rem"},children:t})}return e.jsx("div",{className:"region-selector-container",children:e.jsxs("select",{className:"region-selector",id:"region-select",value:o?.regionID||(n?"all":""),onChange:e=>{const t=e.target.value;if(!t)return void r?.(null);if("all"===t)return void r?.({regionName:"All Regions",regionID:"all"});const o=s.find(e=>String(e.regionID)===t);o&&r?.(o)},children:[!n&&e.jsx("option",{value:"",children:"*Select a Region*"}),n&&e.jsx("option",{value:"all",children:"All Regions"}),g.length>0&&e.jsx("optgroup",{label:"Popular Regions",children:g.map(t=>e.jsx("option",{value:t.regionID,children:t.regionName},t.regionID))}),e.jsx("optgroup",{label:"All Regions (Alphabetical)",children:p.map(t=>e.jsx("option",{value:t.regionID,children:t.regionName},`all-${t.regionID}`))})]})})}const w=e=>Math.floor(10*e)/10,j=e=>e?.split(" ").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")??"",$=e=>`${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} ISK`,y=e=>`${Math.floor(e/1440)}d ${Math.floor(e%1440/60)}h ${e%60}m`,E=e=>{const t=parseInt(e,10);if(-1===t)return"Station";if(0===t)return"System";if(32767===t)return"Region";if(!isNaN(t))return`${t} ${1===t?"Jump":"Jumps"}`;const o=String(e).trim().toLowerCase();return["station","system","region"].includes(o)?j(o):j(e)},v=e=>{const t=[[1,"#2e74df"],[.9,"#389cf6"],[.8,"#4acff3"],[.7,"#62daa6"],[.6,"#71e452"],[.5,"#eeff83"],[.4,"#de6a0c"],[.3,"#ce4611"],[.2,"#bb1014"],[.1,"#6d221d"],[0,"#8f2f69"]];for(const[o,r]of t)if(e>=o)return r;return"#8f2f69"},S="none",N="mild",R="moderate",b="strict",A="ultra";function D(e,t=S){if(t===S||e.length<10)return e;const o=[...e].sort((e,t)=>e.price-t.price);let r,n,s;switch(t){case N:r=.05,n=.95,s=1.5;break;case R:r=.1,n=.9,s=1;break;case b:r=.25,n=.75,s=.5;break;case A:r=.375,n=.625,s=.25;break;default:return e}const i=Math.floor(o.length*r),a=Math.floor(o.length*n),c=o[i].price,l=o[a].price,u=l-c,f=Math.max(c,c-s*u),g=l+s*u;return o.filter(e=>e.price>=f&&e.price<=g)}function x(e){const t=[];return function e(o,r=[]){for(const[n,s]of Object.entries(o))if("_info"!==n){if(Array.isArray(s?.items))for(const e of s.items)t.push({...e,categoryPath:[...r,n].join(" > ")});for(const[t,o]of Object.entries(s))"items"!==t&&"_info"!==t&&"object"==typeof o&&e({[t]:o},[...r,n])}}(e),t}export{n as A,s as E,m as R,y as a,E as b,j as c,D as d,x as e,$ as f,v as g,l as h,u as i,f as j,p as k,c as l,g as m,h as n,i as o,w as t};
//# sourceMappingURL=common-fh4CIMrf.js.map

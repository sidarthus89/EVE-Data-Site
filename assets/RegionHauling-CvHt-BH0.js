import{j as e}from"./index-BVWZRb2-.js";import{r as t}from"./react-vendor-qWGkjVPF.js";import{h as n,R as i,g as a,i as r,j as l}from"./common-CE_KgpKB.js";import{c as s,s as o}from"./stations-B9jcwKR6.js";const c=(e,t=2)=>{if(null==e||isNaN(e))return"0";return parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})},u={fromRegion:null,toRegion:null,nearbyOnly:!1,minProfit:"500000",maxWeight:"",minROI:4,maxJumps:"",maxBudget:"",salesTax:7.5,securityStatus:"any",structureType:"both",routePreference:"safest",hideOutOfStock:!1};function m(){const[m,d]=t.useState(u),[h,p]=t.useState(null),[g,x]=t.useState(null),[y,f]=t.useState(!1),[j,v]=t.useState([]),[b,N]=t.useState(null),[P,_]=t.useState(!1),[k,S]=t.useState([]),[R,w]=t.useState(1),[I]=t.useState(50),[C,T]=t.useState(!1),[F,O]=t.useState(!1),[B,J]=t.useState({key:null,direction:"asc"}),[M,D]=t.useState(!1),A=async e=>{try{const t=await l(`https://esi.evetech.net/latest/universe/types/${e}/`);return{volume:t.volume||.01,name:t.name||`Item ${e}`}}catch(t){return{volume:.01,name:`Item ${e}`}}},U=async(e,t)=>{try{return(await l(`https://esi.evetech.net/latest/route/${e}/${t}/`)).length-1}catch(n){return"N/A"}};t.useEffect(()=>{const e=()=>{const e=document.querySelector(".hauling-form");if(e){const t=e.getBoundingClientRect(),n=60;T(t.top<=n)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const L=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){}};t.useEffect(()=>{n().then(e=>{p(e)}).catch(e=>{N("Failed to load regions data")})},[]);const V=t.useMemo(()=>h?h.map(e=>({regionID:e.region_id||e.regionID,regionName:e.region_name||e.regionName||e.name,...e})):[],[h]);t.useEffect(()=>{m.fromRegion&&V.length,S([])},[m.fromRegion,V]),t.useEffect(()=>{m.nearbyOnly&&k.length>0?d(e=>({...e,toRegion:{regionID:"nearby",regionName:`${k.length} Nearby Regions`}})):m.nearbyOnly||"nearby"!==m.toRegion?.regionID||d(e=>({...e,toRegion:null}))},[m.nearbyOnly,k]);const $=(e,t)=>{d(n=>({...n,[e]:t||("minProfit"===e?"500000":n[e])}))},E=async(e,t,n)=>{try{const i=(await s(e,t)).filter(e=>{const t=e.profit_per_unit??e.buy_price-e.sell_price??0,i=e.max_volume??0,a=e.total_profit??t*i,r=e.profit_margin??(e.sell_price?t/e.sell_price*100:0),l=a>=parseFloat(n.minProfit||0),s=(e.sell_price??0)*i,o=!n.maxBudget||s<=parseFloat(n.maxBudget);return l&&r>=parseFloat(n.minROI||0)&&o});return await(async(e,t)=>{const n=await r(),i=new Map(o.map(e=>[Number(e.station_id||e.stationID),e])),a=new Map(n.map(e=>[Number(e.stationID),e]));if(!e||!Array.isArray(e))return[];const l=t.maxWeight?parseFloat(t.maxWeight):null,s=[];for(const r of e){const e=await A(r.type_id);let t=r.max_volume||0;if(l&&e.volume>0){const n=Math.floor(l/e.volume);t=Math.min(t,n)}const n=Math.floor(t*e.volume);let o,c,u,m,d,h=null,p=null;if(r.origin_name&&r.destination_name)o=r.origin_name,c=r.destination_name,u=r.origin_is_npc??!0,m=r.destination_is_npc??!0,d=r.jumps??"N/A";else{const e=r.origin_id??r.from_location??r.source_station_id,t=r.destination_id??r.to_location??r.destination_station_id;h=i.get(e)||a.get(e)||{},p=i.get(t)||a.get(t)||{},h.name,p.name,o=h.name||`Unknown Station (ID: ${e})`,c=p.name||`Unknown Station (ID: ${t})`,u="station"===h.type||1===h.is_npc,m="station"===p.type||1===p.is_npc,d="N/A";const n=r.origin_system_id||h.system_id,l=r.destination_system_id||p.system_id;n&&l&&(d=await U(n,l))}let g=r.origin_security??(h?h.security_status??h.security??null:null),x=r.destination_security??(p?p.security_status??p.security??null:null);g=null!=g?Number(g):g,x=null!=x?Number(x):x;const y=r.profit_per_jump??(d&&"number"==typeof d&&d>0?(r.profit_per_unit||0)*t/d:null);s.push({Item:r.name||e.name,From:{name:o,security:g,isNPC:u,systemId:r.origin_system_id||(h?h.system_id:null)},To:{name:c,security:x,isNPC:m,systemId:r.destination_system_id||(p?p.system_id:null)},"Buy Price":r.sell_price||0,"Sell Price":r.buy_price||0,"Profit Per Unit":r.profit_per_unit||0,"Profit Percentage":r.profit_margin||0,Quantity:t,"Total Volume (m3)":r.total_volume||n,"Item Volume":r.volume||e.volume,Jumps:d,"Profit per Jump":y,"Total Profit":r.total_profit||(r.profit_per_unit||0)*t,ROI:r.profit_margin,_rawData:r})}return s})(i,n)}catch(i){throw new Error("Failed to fetch market orders.")}},Q=e=>{J(t=>t.key===e?{key:e,direction:"asc"===t.direction?"desc":"asc"}:{key:e,direction:"asc"})},W=t.useMemo(()=>{if(!B.key)return j;const e=[...j];return e.sort((e,t)=>{const n=(e,t)=>{switch(t){case"Item":return e.Item||"";case"From":return e.From&&e.From.name||e.From||"";case"To":return e.To&&e.To.name||e["Take To"]||"";case"Quantity":return e.Quantity||0;case"Buy Price":return e["Buy Price"]||0;case"Total Buy Price":return(e["Buy Price"]||0)*(e.Quantity||0);case"Sell Price":return e["Sell Price"]||0;case"Net Profit":return e["Total Profit"]||0;case"Jumps":return"number"==typeof e.Jumps?e.Jumps:0;case"Profit per Jump":return"number"==typeof e.Jumps&&e["Total Profit"]?e["Total Profit"]/e.Jumps:0;case"Profit Per Item":return e["Profit Per Unit"]||0;case"ROI":return e["Profit Percentage"]||0;case"Total Volume (m³)":return e["Total Volume (m3)"]||0;default:return e[t]||""}},i=n(e,B.key),a=n(t,B.key);return"number"==typeof i&&"number"==typeof a?"asc"===B.direction?i-a:a-i:"asc"===B.direction?String(i).localeCompare(String(a)):String(a).localeCompare(String(i))}),e},[j,B]);return h?e.jsxs("div",{className:"region-hauling",children:[e.jsx("div",{className:"static-header",children:e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Region to Region Trading"}),e.jsx("p",{className:"disclaimer",children:"This feature is still a WIP and may have issues."})]})}),e.jsxs("div",{className:"scrollable-content",children:[e.jsx("div",{className:"hauling-form",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v([]),w(1),f(!0),N(null),D(!1),!m.fromRegion?.regionID||!m.toRegion?.regionID)return N("Please select both source and destination regions"),void f(!1);try{const e=Number(m.fromRegion.regionID),t=Number(m.toRegion.regionID),n=await E(e,t,m);n.length>0?(v(n),D(!0)):N("No profitable trades found for the selected criteria.")}catch(t){N(t.message)}finally{f(!1)}},children:[e.jsx("div",{className:"form-container",children:e.jsxs("div",{className:"form-row form-row-main",style:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"20px",padding:"0 20px",overflowX:"auto",margin:"0 auto 10px auto"},children:[e.jsxs("div",{className:"form-group region-group",children:[e.jsx("label",{children:"Starting Region"}),e.jsx(i,{selectedRegion:m.fromRegion,onRegionChange:e=>{d(t=>({...t,fromRegion:e,nearbyOnly:!(!t.nearbyOnly||!e)&&t.nearbyOnly}))},allowAllRegions:!1})]}),e.jsxs("div",{className:"form-group region-group",children:[e.jsx("label",{children:"Ending Region"}),m.nearbyOnly?e.jsx("div",{className:"nearby-region-display",children:"…"}):e.jsx(i,{selectedRegion:m.toRegion,onRegionChange:e=>{d(t=>({...t,toRegion:e,nearbyOnly:!1}))},allowAllRegions:!1})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Security"}),e.jsx("select",{value:m.securityStatus,onChange:e=>$("securityStatus",e.target.value),className:"form-control",style:{width:"115px"},children:[{value:"any",label:"Any"},{value:"highsec",label:"High-Sec"},{value:"lowsec",label:"Low-Sec"},{value:"nullsec",label:"Null-Sec"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stations/Structures"}),e.jsx("select",{value:m.structureType,onChange:e=>$("structureType",e.target.value),className:"form-control",style:{width:"165px"},children:[{value:"both",label:"Any"},{value:"stations",label:"NPC Stations"},{value:"structures",label:"Player Structures"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Route"}),e.jsx("select",{value:m.routePreference,onChange:e=>$("routePreference",e.target.value),className:"form-control",style:{width:"155px"},children:[{value:"safest",label:"Safest Route"},{value:"shortest",label:"Shortest Route"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Jumps"}),e.jsx("input",{type:"number",value:m.maxJumps,onChange:e=>$("maxJumps",e.target.value),placeholder:"∞",className:"form-control",style:{width:"80px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Budget"}),e.jsx("input",{type:"number",value:m.maxBudget,onChange:e=>$("maxBudget",e.target.value),placeholder:"∞",className:"form-control",style:{width:"165px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Capacity (m³)"}),e.jsx("input",{type:"number",value:m.maxWeight,onChange:e=>$("maxWeight",e.target.value),placeholder:"∞",className:"form-control",style:{width:"135px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sales Tax"}),e.jsx("select",{value:m.salesTax,onChange:e=>$("salesTax",Number(e.target.value)),className:"form-control",style:{width:"155px"},children:[{level:0,tax:7.5,label:"No Skill: 7.5%"},{level:1,tax:6.675,label:"Lvl I: 6.675%"},{level:2,tax:5.85,label:"Lvl II: 5.85%"},{level:3,tax:5.025,label:"Lvl III: 5.025%"},{level:4,tax:4.2,label:"Lvl IV: 4.2%"},{level:5,tax:3.375,label:"Lvl V: 3.375%"}].map(t=>e.jsx("option",{value:t.tax,children:t.label},t.level))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min Profit"}),e.jsx("input",{type:"number",value:m.minProfit,onChange:e=>$("minProfit",e.target.value),className:"form-control",style:{width:"175px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min ROI %"}),e.jsx("input",{type:"number",value:m.minROI,onChange:e=>$("minROI",Number(e.target.value)||0),className:"form-control",style:{width:"100px"}})]})]})}),b&&e.jsx("div",{className:"error-message",children:b}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",disabled:y||!m.fromRegion||!m.toRegion,className:"submit-btn",children:y?"Searching...":"Find Trade Routes"})})]})}),M&&W.length>0&&e.jsxs("div",{className:"results-container",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("h2",{children:["Trade Route Results (",W.length," found)"]}),P&&e.jsx("div",{className:"fallback-warning",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"4px",padding:"10px",margin:"10px 0",color:"#856404"},children:"⚠️ Azure Functions unavailable. Using basic market data analysis. Results may be limited to common trade items."}),e.jsx("button",{onClick:()=>{v([]),N(null),w(1),_(!1),D(!1)},className:"new-search-btn",children:"Clear Results"})]}),e.jsx("div",{className:"results-table-container",children:e.jsxs("table",{className:"results-table wide-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Q("Item"),children:["Item","Item"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("From"),children:["From","From"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Quantity"),children:["Quantity","Quantity"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Buy Price"),children:["Buy Price","Buy Price"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Total Buy Price"),children:["Total Buy","Total Buy Price"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("To"),children:["To","To"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Sell Price"),children:["Sell Price","Sell Price"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Net Profit"),children:["Net Profit","Net Profit"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Jumps"),children:["Jumps","Jumps"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Profit per Jump"),children:["Profit/Jump","Profit per Jump"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Profit Per Item"),children:["Profit/Unit","Profit Per Item"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("ROI"),children:["ROI%","ROI"===B.key?"asc"===B.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Total Volume (m³)"),children:["Volume (m³)","Total Volume (m³)"===B.key?"asc"===B.direction?" ▲":" ▼":""]})]})}),e.jsx("tbody",{children:(()=>{const t=(R-1)*I,n=t+I;return W.slice(t,n).map((n,i)=>{const r=n.Item||"Unknown Item",l=n.From||{},s=n.To||n["Take To"]||{},o=n["Buy Price"]||0,u=n["Sell Price"]||0,m=n["Profit Per Unit"]||0,d=n["Profit Percentage"]||0,h=n["Total Profit"]||0,p=n.Quantity||0,g=n["Total Volume (m3)"]||0,x=n.Jumps||"N/A",y=o*p,f="number"==typeof x&&x>0?h/x:0,j=t=>{if("string"==typeof t)return e.jsx("span",{className:"clickable-location",onClick:()=>L(t),title:"Click to copy to clipboard",children:t});const n=t.name||"Unknown Station",i=t.security,r=t.isNPC;let l="#ffffff";return null!=i&&(l=a(i)),e.jsx("span",{className:"clickable-location",style:{color:l},onClick:()=>L(n),title:`Security: ${null!=i?i.toFixed(1):"Unknown"} | ${r?"NPC Station":"Player Structure"} | Click to copy`,children:n})};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"clickable-location",onClick:()=>L(r),title:"Click to copy item name",children:r})}),e.jsx("td",{children:j(l)}),e.jsx("td",{children:c(p,0)}),e.jsx("td",{children:c(o)}),e.jsx("td",{children:c(y)}),e.jsx("td",{children:j(s)}),e.jsx("td",{children:c(u)}),e.jsx("td",{children:c(h)}),e.jsx("td",{children:x}),e.jsx("td",{children:c(f)}),e.jsx("td",{children:c(m)}),e.jsxs("td",{children:[c(d,1),"%"]}),e.jsx("td",{children:c(g,0)})]},t+i)})})()})]})}),W.length>I&&e.jsx("div",{className:"pagination-container",children:e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>w(e=>Math.max(e-1,1)),disabled:1===R,className:"pagination-btn",children:"Previous"}),e.jsxs("span",{className:"pagination-info",children:["Page ",R," of ",Math.ceil(W.length/I),"(",W.length," total results)"]}),e.jsx("button",{onClick:()=>w(e=>Math.min(e+1,Math.ceil(W.length/I))),disabled:R>=Math.ceil(W.length/I),className:"pagination-btn",children:"Next"})]})})]})]}),e.jsx("div",{className:"return-to-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),title:"Return to Top",children:"↑"})]}):e.jsx("div",{className:"region-hauling",children:e.jsx("div",{className:"loading-container",children:e.jsx("p",{children:"Loading regions..."})})})}export{m as default};

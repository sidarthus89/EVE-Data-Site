import{j as e}from"./index-labcONku.js";import{r as t}from"./react-vendor-qWGkjVPF.js";const r=`${"/EVE-Data-Site/".replace(/\/$/,"")}/data`,n="".replace(/\/$/,"")||r,o=({}.VITE_AZURE_BASE||"https://evedatafunc01.azurewebsites.net/api").replace(/\/$/,""),i="https://esi.evetech.net/latest";async function s(e,t={},r=3){for(let o=0;o<r;o++)try{const r=await fetch(e,t);if(!r.ok){await r.text();throw new Error(`HTTP ${r.status}: ${r.statusText}`)}const n=r.headers.get("content-type");if(n&&n.includes("application/json"))return await r.json();await r.text();throw new Error("Response is not JSON")}catch(n){if(o===r-1)throw n;await new Promise(e=>setTimeout(e,1e3*Math.pow(2,o)))}}async function a(e){let t;for(const n of e.filter(Boolean))try{return await s(n)}catch(r){t=r}throw t||new Error("No sources available")}function c(){return a([`${n}/market.json`,`${n}/market/market.json`])}function l(){return a([`${n}/regions.json`,`${n}/regions/regions.json`]).then(e=>{if(Array.isArray(e))return e;if(e&&Array.isArray(e.regions))return e.regions;throw new Error("Invalid regions.json format")})}function u(){return a([`${n}/structures.json`,`${n}/structures/structures.json`])}function f(){return a([`${n}/stations.json`,`${n}/stations/stations_npc.json`])}async function g(e,t,r="shortest"){const n=Number(e),o=Number(t);if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("invalid-system-ids");const s=`${i}/route/${n}/${o}/?flag=${"secure"===r||"shortest"===r?r:"shortest"}`,a=await fetch(s,{headers:{"User-Agent":"EVE-Data-Site"}});if(!a.ok)throw new Error(`ESI route ${a.status}`);const c=await a.json();return Array.isArray(c)?c:null}function h(e){const t=String(e);try{const e=`${t}.json`,r=`${o}/log/request?name=${encodeURIComponent(e)}&source=${encodeURIComponent("spa:region_orders")}`;"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon?navigator.sendBeacon(r,"1"):fetch(r,{method:"GET",mode:"no-cors",cache:"no-store",keepalive:!0}).catch(()=>{})}catch{}return fetch(`${n}/region_orders/${t}.json`).then(async e=>{if(!e.ok)throw new Error(`snapshot-missing:${e.status}`);if(!(e.headers.get("content-type")||"").includes("application/json"))throw new Error("snapshot-not-json");return e.json()})}async function p(){const{owner:e,repo:t}=function(){try{const e="sidarthus89",t="EVE-Data-Site",r=r=>{const n=new URL(r),o=n.hostname||"",i=(n.pathname||"/").split("/").filter(Boolean);return o.endsWith("github.io")&&i.length>0?{owner:o.split(".")[0]||e,repo:i[0]||t}:null};if(/^https?:\/\//i.test(n)){const e=r(n);if(e)return e}if("undefined"!=typeof window){const e=r(window.location.href);if(e)return e}return{owner:e,repo:t}}catch{return{owner:"sidarthus89",repo:"EVE-Data-Site"}}}(),r=`https://api.github.com/repos/${e}/${t}/commits?sha=gh-pages&path=data&per_page=1`;try{const e=await fetch(r,{headers:{Accept:"application/vnd.github+json"}});if(e.ok){const t=await e.json(),r=Array.isArray(t)?t[0]:null,n=r?.commit?.committer?.date||r?.commit?.author?.date;if(n)return new Date(n).toISOString()}}catch{}return null}const m=["The Forge","Domain","Heimatar","Sinq Laison","Metropolis"];function d({selectedRegion:r,onRegionChange:n,allowAllRegions:o=!0}){const[i,s]=t.useState([]),[a,c]=t.useState(null),[u,f]=t.useState(!0);t.useEffect(()=>{!async function(){try{const e=await l();if(!e||!Array.isArray(e))throw new Error("Invalid regions data format");const t=19000001,r=e.filter(e=>e.regionID!==t);s(r),c(null),f(!1)}catch(e){c(`Failed to load regions: ${e.message}`),s([]),f(!1)}}()},[]),t.useEffect(()=>{o&&(!r||!r.regionID)&&i.length>0&&n?.({regionName:"All Regions",regionID:"all"})},[r,i,n,o]);const{popularRegionsList:g,otherRegionsList:h,allRegionsList:p}=t.useMemo(()=>({popularRegionsList:i.filter(e=>m.includes(e.regionName)).sort((e,t)=>e.regionName.localeCompare(t.regionName)),otherRegionsList:i.filter(e=>!m.includes(e.regionName)).sort((e,t)=>e.regionName.localeCompare(t.regionName)),allRegionsList:i.slice().sort((e,t)=>e.regionName.localeCompare(t.regionName))}),[i]);if(a)return e.jsxs("div",{style:{color:"red",padding:"1rem"},children:["Error loading regions: ",a]});if(0===i.length){const t=u?"Loading regions...":"Discovering regions from market data...";return e.jsx("div",{style:{padding:"1rem"},children:t})}return e.jsx("div",{className:"region-selector-container",children:e.jsxs("select",{className:"region-selector",id:"region-select",value:r?.regionID||(o?"all":""),onChange:e=>{const t=e.target.value;if(!t)return void n?.(null);if("all"===t)return void n?.({regionName:"All Regions",regionID:"all"});const r=i.find(e=>String(e.regionID)===t);r&&n?.(r)},children:[!o&&e.jsx("option",{value:"",children:"*Select a Region*"}),o&&e.jsx("option",{value:"all",children:"All Regions"}),g.length>0&&e.jsx("optgroup",{label:"Popular Regions",children:g.map(t=>e.jsx("option",{value:t.regionID,children:t.regionName},t.regionID))}),e.jsx("optgroup",{label:"All Regions (Alphabetical)",children:p.map(t=>e.jsx("option",{value:t.regionID,children:t.regionName},`all-${t.regionID}`))})]})})}const w=e=>Math.floor(10*e)/10,y=e=>e?.split(" ").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")??"",j=e=>`${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} ISK`,$=e=>`${Math.floor(e/1440)}d ${Math.floor(e%1440/60)}h ${e%60}m`,E=e=>{const t=parseInt(e,10);if(-1===t)return"Station";if(0===t)return"System";if(32767===t)return"Region";if(!isNaN(t))return`${t} ${1===t?"Jump":"Jumps"}`;const r=String(e).trim().toLowerCase();return["station","system","region"].includes(r)?y(r):y(e)},b=e=>{if(null==e||isNaN(e))return"#8f2f69";let t=Math.round(10*e)/10;t<0&&(t=0),t>1&&(t=1);return{1:"#2e74df",.9:"#389cf6",.8:"#4acff3",.7:"#62daa6",.6:"#71e452",.5:"#eeff83",.4:"#de6a0c",.3:"#ce4611",.2:"#bb1014",.1:"#6d221d",0:"#8f2f69"}[t]??"#8f2f69"},v="none",A="mild",N="moderate",R="strict",S="ultra";function D(e,t=v){if(t===v||e.length<4)return e;const r=[...e].sort((e,t)=>e.price-t.price);let n,o,i;switch(t){case A:n=.05,o=.95,i=1.5;break;case N:n=.1,o=.9,i=1;break;case R:n=.25,o=.75,i=.5;break;case S:n=.375,o=.625,i=.25;break;default:return e}const s=Math.floor(r.length*n),a=Math.floor(r.length*o),c=r[s].price,l=r[a].price,u=l-c,f=Math.max(c,c-i*u),g=l+i*u;return r.filter(e=>e.price>=f&&e.price<=g)}function I(e){const t=[],r={};return function e(n,o=[]){if(!n||"object"!=typeof n)return;const i=Array.isArray(n)?n.map(e=>[e.name,e]):Object.entries(n);for(const[s,a]of i)if(a&&"object"==typeof a){if(Array.isArray(a.items))for(const e of a.items)e&&"object"==typeof e&&(t.push({...e}),r[e.typeID]=[...o,s]);for(const[t,r]of Object.entries(a))"items"!==t&&"_info"!==t&&r&&"object"==typeof r&&e(r,[...o,s])}}(e,[]),{items:t,pathMap:r}}export{o as A,i as E,d as R,$ as a,E as b,y as c,D as d,I as e,j as f,b as g,l as h,u as i,f as j,p as k,g as l,c as m,h as n,s as o,w as t};

import{j as e}from"./index-DDVLMgF8.js";import{r as t,b as n,u as i}from"./react-vendor-BJsIi5Ft.js";import{R as s,f as o,a as r,g as l,c as a,b as c,t as d,d as u,e as m,h,i as g,j as f}from"./common-C9hM7hE5.js";import{G as p}from"./icons-BZtG8gh1.js";import{u as y,f as b,g as x,a as v,b as S,c as w}from"./index-IJeDGufi.js";import{R as j,C as N,X as k,Y as C,T as I,L as z,B as E,a as M,b as _,A as D}from"./chart-vendor-BiXL5GAv.js";import{f as R,a as A,b as F}from"./market-D5TlsuZ8.js";function O({marketTree:n,expandedNodes:i,setExpandedNodes:s,onItemSelect:o}){const[r,l]=t.useState(""),[a,c]=t.useState([]);t.useEffect(()=>{if(r.length>=4){const e=function(e,t){const n=[],i=new Set;function s(t){if(null!==t&&"object"==typeof t&&!i.has(t)){if(i.add(t),Array.isArray(t.items)){const i=t.items.filter(t=>t.typeName?.toLowerCase().includes(e.toLowerCase()));n.push(...i)}for(const[e,n]of Object.entries(t))["_info","items"].includes(e)||s(n)}}return Array.isArray(t)?t.forEach(s):s(t),n}(r,n),t=e.sort((e,t)=>e.typeName.localeCompare(t.typeName));c(t)}else c([])},[r,n]);const d=t.useRef();t.useEffect(()=>{function e(e){d.current&&!d.current.contains(e.target)&&c([])}function t(e){"Escape"===e.key&&c([])}return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[]);const u=e=>{const t=L(e.typeID,n);if(t){const e=new Set(i);t.reduce((t,n)=>{const i=[...t,n].join("/");return e.add(i),[...t,n]},[]),s(e)}else console.warn("⚠️ No path found for item (still selecting it):",e);o(e),c([]),l(e.typeName)};return e.jsxs("div",{className:"search-bar",ref:d,children:[e.jsx("input",{type:"text",placeholder:"Search",value:r,onChange:e=>{const t=e.target.value;l(t)},onKeyDown:e=>{if("Enter"===e.key){const e=a.find(e=>e.typeName===r);e&&u(e)}}}),e.jsx("span",{className:"search-clear",title:"Clear Search",onClick:()=>{l(""),c([])},children:"╳"}),r.length>=4&&a.length>0&&e.jsx("ul",{className:"search-suggestions",children:a.map(t=>e.jsx("li",{onClick:()=>u(t),className:"suggestion-item",children:t.typeName},t.typeID))})]})}function L(e,t,n=[],i=new Set){if(null===t||"object"!=typeof t)return null;if(i.has(t))return null;i.add(t);for(const[s,o]of Object.entries(t)){if("object"!=typeof o||null===o)continue;const t=[...n,s];if(Array.isArray(o.items)){if(o.items.find(t=>String(t.typeID)===String(e)))return t}for(const[n,s]of Object.entries(o)){if(["_info","items"].includes(n))continue;if("object"!=typeof s||null===s)continue;const o=L(e,s,[...t,n],i);if(o)return o}}return null}const T="eveQuickbar";function V({onItemSelect:n}){const[i,s]=t.useState([]);t.useEffect(()=>{const e=localStorage.getItem(T);if(e)try{s(JSON.parse(e))}catch(t){console.error("❌ Failed to parse quickbar items",t)}},[]),t.useEffect(()=>{const e=e=>{const t=e.detail;s(e=>{if(e.some(e=>e.typeID===t.typeID))return e;const n=[...e,t];return localStorage.setItem(T,JSON.stringify(n)),n})};return window.addEventListener("quickbar:add",e),()=>window.removeEventListener("quickbar:add",e)},[]);return 0===i.length?e.jsxs("div",{className:"quickbar-empty",children:[e.jsx("p",{children:"No items in quickbar"}),e.jsx("p",{className:"quickbar-hint",children:"Hover over items in the market tree and click the + button to add them here"})]}):e.jsx("div",{className:"quickbar",children:i.map(t=>e.jsxs("div",{className:"quickbar-item",children:[e.jsxs("div",{className:"quickbar-item-name",onClick:()=>n?.(t),children:[e.jsx("img",{src:`https://images.evetech.net/types/${t.typeID}/icon?size=32`,alt:"",className:"quickbar-item-icon"}),e.jsx("span",{children:t.typeName})]}),e.jsx("button",{className:"quickbar-remove-btn",onClick:()=>{return e=t.typeID,void s(t=>{const n=t.filter(t=>t.typeID!==e);return localStorage.setItem(T,JSON.stringify(n)),n});var e},title:"Remove from quickbar",children:"×"})]},t.typeID))})}const P="marketTreeState",$="selectedItemID";function W({node:t,nodeName:n,path:i,onItemSelect:s,expandedNodes:o,toggleNode:r}){const l=[...i,n],a=l.join("/"),c=o.has(a),d=Object.keys(t).some(e=>!["_info","items","name"].includes(e)),u=Array.isArray(t.items)&&t.items.length>0;return e.jsxs("li",{children:[e.jsxs("div",{className:"tree-group-header",onClick:()=>r(a),children:[t._info?.iconFile&&e.jsx("img",{src:t._info?.iconFile?`/EVE-Data-Site-Dev/assets/marketGroupIcons/${t._info.iconFile}`:"/EVE-Data-Site-Dev/assets/marketGroupIcons/defaultGroupIcon.png",alt:"",className:"group-icon",onError:e=>{e.target.onerror=null,e.target.src="/EVE-Data-Site-Dev/assets/marketGroupIcons/defaultGroupIcon.png"}}),n]}),c&&e.jsxs(e.Fragment,{children:[u&&e.jsx("ul",{children:t.items.map(t=>e.jsxs("li",{className:"market-item with-button",children:[e.jsx("span",{id:`item-${t.typeID}`,className:"item-name",onClick:()=>{localStorage.setItem($,t.typeID),s?.(t)},children:t.typeName}),e.jsx("button",{className:"quickbar-add-btn",title:"Add to Quickbar",onClick:e=>{e.stopPropagation(),window.dispatchEvent(new CustomEvent("quickbar:add",{detail:{typeID:t.typeID,typeName:t.typeName,groupID:t.groupID,categoryID:t.categoryID}}))},children:"+"})]},t.typeID))}),d&&e.jsx("ul",{children:Object.entries(t).map(([t,n])=>"_info"===t||"items"===t||"name"===t?null:e.jsx(W,{node:n,nodeName:t,path:l,onItemSelect:s,expandedNodes:o,toggleNode:r},[...l,t].join("/")))})]})]})}function K({marketTree:n,onItemSelect:i,breadcrumbPath:s,collapseVersion:o}){const[r,l]=t.useState(new Set);function a(e){l(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}function c(e){l(t=>{const n=new Set(t);for(let i=0;i<e.length;i++){const t=e.slice(0,i+1).join("/");n.add(t)}return n})}return t.useEffect(()=>{const e=localStorage.getItem(P);if(e)try{l(new Set(JSON.parse(e)))}catch(t){console.warn("Could not parse tree state",t)}},[]),t.useEffect(()=>{void 0!==o&&(l(new Set),localStorage.setItem(P,JSON.stringify([])))},[o]),t.useEffect(()=>{localStorage.setItem(P,JSON.stringify([...r]))},[r]),t.useEffect(()=>{s&&s.length>0&&l(e=>{const t=new Set(e);for(let n=0;n<s.length;n++){const e=s.slice(0,n+1).join("/");t.add(e)}return t})},[s]),t.useEffect(()=>{"undefined"!=typeof window&&(window.marketTreeNavigate=c)},[]),t.useEffect(()=>{if(!s||0===s.length||!n)return;const e=localStorage.getItem($);e&&setTimeout(()=>{const t=document.getElementById(`item-${e}`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})},100)},[s,n]),n?e.jsx("ul",{className:"menuList menuListtop",children:n.map((t,n)=>e.jsx(W,{node:t,nodeName:t.name,path:[],onItemSelect:i,expandedNodes:r,toggleNode:a},t.name||n))}):null}function q({selectedRegion:n,onRegionChange:i,regions:o,onItemSelect:r,marketTree:l,breadcrumbPath:a}){const[c,d]=t.useState("market"),[u,m]=t.useState(new Set),h=t.useRef(null),g=t.useRef(null),f=t.useRef(null);t.useEffect(()=>{const e=()=>{const e=h.current,t="market"===c?g.current:f.current;e&&t&&(e.style.setProperty("--underline-x",`${t.offsetLeft}px`),e.style.setProperty("--underline-width",`${t.offsetWidth}px`))},t=setTimeout(e,10);return window.addEventListener("resize",e),()=>{clearTimeout(t),window.removeEventListener("resize",e)}},[c]);const[p,y]=t.useState(0),b=e=>d(e);return e.jsxs("aside",{id:"sidebar",className:"sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("div",{className:"regionSelector-wrapper",children:e.jsx(s,{selectedRegion:n,onRegionChange:i,regions:o})}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx(O,{marketTree:l,expandedNodes:u,setExpandedNodes:m,onItemSelect:r}),e.jsx("button",{className:"collapse-button",title:"Collapse all groups",onClick:()=>{m(new Set),y(e=>e+1)},children:e.jsx("img",{src:"/EVE-Data-Site-Dev/assets/collapse.png",alt:"Collapse"})})]}),e.jsx("div",{className:"tab-container",ref:h,children:e.jsxs("div",{className:"sidebar-tabs",children:[e.jsx("button",{ref:g,className:"sidebar-tab-link "+("market"===c?"active":""),onClick:()=>b("market"),children:"Market"}),e.jsx("button",{ref:f,className:"sidebar-tab-link "+("quickbar"===c?"active":""),onClick:()=>b("quickbar"),children:"Quickbar"})]})})]}),e.jsxs("div",{className:"sidebar-scrollable",children:["market"===c&&l&&e.jsx(K,{marketTree:l,onItemSelect:r,breadcrumbPath:a,collapseVersion:p}),"quickbar"===c&&e.jsx(V,{onItemSelect:r})]})]})}function U(e){return p({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"},child:[]}]})(e)}function B(e){return p({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"},child:[]}]})(e)}function X(e){return p({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"},child:[]},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"},child:[]}]})(e)}function H(e){return p({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(e)}function Q({selectedItem:n,marketTree:i,onBreadcrumbClick:s}){const[o,r]=t.useState([]),[l,a]=t.useState(!1);t.useEffect(()=>{if(n?.typeID&&i){const e=function(e,t){const n=Number(e);let i=[];function s(e){return Array.isArray(e)&&e.some(e=>e&&"object"==typeof e&&Number(e.typeID)===n)}function o(e){return e}function r(e,t=[],n){if(!e||"object"!=typeof e)return!1;if(0===t.length&&n){t=[{key:n,name:o(n)}]}if(s(e.items))return i=t.map(e=>e.name),!0;for(const[o,r]of Object.entries(e))if("_info"!==o&&"items"!==o&&Array.isArray(r)&&s(r))return i=t.map(e=>e.name),!0;for(const[i,s]of Object.entries(e))if("_info"!==i&&"items"!==i&&s&&"object"==typeof s&&!Array.isArray(s)){const e=o(i);if(r(s,[...t,{key:i,name:e}],i))return!0}return!1}if(Array.isArray(t)){for(const l of t)if(l&&"object"==typeof l){if(r(l,[],l.name||"Unknown"))return i}}else for(const[l,a]of Object.entries(t))if(a&&"object"==typeof a&&!Array.isArray(a)&&r(a,[],l))return i;return["Unknown Category"]}(n.typeID,i);r(e)}},[n,i]);const c=`https://images.evetech.net/types/${n?.typeID}/icon?size=64`;return n?e.jsxs("div",{className:"item-viewer",children:[e.jsx("img",{src:c,alt:n.typeName,className:"item-icon",onError:e=>e.target.src="/assets/fallback_icon.png"}),e.jsxs("div",{className:"item-details",children:[e.jsx("div",{className:"breadcrumb",children:o.map((t,n)=>e.jsxs("span",{children:[e.jsx("a",{href:"#",onClick:e=>{e.preventDefault(),s(o.slice(0,n+1))},children:t}),n<o.length-1&&e.jsx("span",{children:" / "})]},n))}),e.jsxs("div",{className:"item-header-row",children:[e.jsx("div",{className:"item-name",children:n.typeName}),e.jsx("button",{className:"quickbar-btn",onClick:()=>{const e="eveQuickbar",t=JSON.parse(localStorage.getItem(e)||"[]");t.some(e=>e.typeID===n.typeID)||localStorage.setItem(e,JSON.stringify([...t,n]))},title:"Add to Quickbar",style:{minWidth:"140px",padding:"8px 14px",textAlign:"center"},children:"Add to Quickbar"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:async()=>{const e=`${`${window.location.origin}/EVE-Data-Site-Dev/market`}?item=${n.typeID}`;try{await navigator.clipboard.writeText(e),a(!0),setTimeout(()=>a(!1),2e3)}catch(t){console.error("Failed to copy link:",t)}},className:"item-link",title:"Copy market link (opens item on load)",children:l?e.jsx(U,{className:"icon"}):e.jsx(X,{className:"icon"})}),l&&e.jsx("div",{className:"copy-tooltip",style:{top:"-30px",left:"0"},children:"Link copied!"})]})]})]})]}):null}function J(e,t,n){let i,s=n.initialDeps??[];function o(){var o,r,l,a;let c;n.key&&(null==(o=n.debug)?void 0:o.call(n))&&(c=Date.now());const d=e();if(!(d.length!==s.length||d.some((e,t)=>s[t]!==e)))return i;let u;if(s=d,n.key&&(null==(r=n.debug)?void 0:r.call(n))&&(u=Date.now()),i=t(...d),n.key&&(null==(l=n.debug)?void 0:l.call(n))){const e=Math.round(100*(Date.now()-c))/100,t=Math.round(100*(Date.now()-u))/100,i=t/16,s=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${s(t,5)} /${s(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*i,120))}deg 100% 31%);`,null==n?void 0:n.key)}return null==(a=null==n?void 0:n.onChange)||a.call(n,i),i}return o.updateDeps=e=>{s=e},o}function G(e,t){if(void 0===e)throw new Error("Unexpected undefined");return e}const Y=(e,t,n)=>{let i;return function(...s){e.clearTimeout(i),i=e.setTimeout(()=>t.apply(this,s),n)}},Z=e=>{const{offsetWidth:t,offsetHeight:n}=e;return{width:t,height:n}},ee=e=>e,te=e=>{const t=Math.max(e.startIndex-e.overscan,0),n=Math.min(e.endIndex+e.overscan,e.count-1),i=[];for(let s=t;s<=n;s++)i.push(s);return i},ne=(e,t)=>{const n=e.scrollElement;if(!n)return;const i=e.targetWindow;if(!i)return;const s=e=>{const{width:n,height:i}=e;t({width:Math.round(n),height:Math.round(i)})};if(s(Z(n)),!i.ResizeObserver)return()=>{};const o=new i.ResizeObserver(t=>{const i=()=>{const e=t[0];if(null==e?void 0:e.borderBoxSize){const t=e.borderBoxSize[0];if(t)return void s({width:t.inlineSize,height:t.blockSize})}s(Z(n))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return o.observe(n,{box:"border-box"}),()=>{o.unobserve(n)}},ie={passive:!0},se="undefined"==typeof window||"onscrollend"in window,oe=(e,t)=>{const n=e.scrollElement;if(!n)return;const i=e.targetWindow;if(!i)return;let s=0;const o=e.options.useScrollendEvent&&se?()=>{}:Y(i,()=>{t(s,!1)},e.options.isScrollingResetDelay),r=i=>()=>{const{horizontal:r,isRtl:l}=e.options;s=r?n.scrollLeft*(l?-1:1):n.scrollTop,o(),t(s,i)},l=r(!0),a=r(!1);a(),n.addEventListener("scroll",l,ie);const c=e.options.useScrollendEvent&&se;return c&&n.addEventListener("scrollend",a,ie),()=>{n.removeEventListener("scroll",l),c&&n.removeEventListener("scrollend",a)}},re=(e,t,n)=>{if(null==t?void 0:t.borderBoxSize){const e=t.borderBoxSize[0];if(e){return Math.round(e[n.options.horizontal?"inlineSize":"blockSize"])}}return e[n.options.horizontal?"offsetWidth":"offsetHeight"]},le=(e,{adjustments:t=0,behavior:n},i)=>{var s,o;const r=e+t;null==(o=null==(s=i.scrollElement)?void 0:s.scrollTo)||o.call(s,{[i.options.horizontal?"left":"top"]:r,behavior:n})};class ae{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var n;null==(n=t())||n.disconnect(),e=null},observe:e=>{var n;return null==(n=t())?void 0:n.observe(e,{box:"border-box"})},unobserve:e=>{var n;return null==(n=t())?void 0:n.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,n])=>{void 0===n&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ee,rangeExtractor:te,onChange:()=>{},measureElement:re,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,n;null==(n=(t=this.options).onChange)||n.call(t,this,e)},this.maybeNotify=J(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{const n=new Map,i=new Map;for(let s=t-1;s>=0;s--){const t=e[s];if(n.has(t.lane))continue;const o=i.get(t.lane);if(null==o||t.end>o.end?i.set(t.lane,t):t.end<o.end&&n.set(t.lane,!0),n.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=J(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,t,n,i,s)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:n,getItemKey:i,enabled:s}),{key:!1}),this.getMeasurements=J(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:n,getItemKey:i,enabled:s},o)=>{if(!s)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const r=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,r);for(let a=r;a<e;a++){const e=i(a),s=1===this.options.lanes?l[a-1]:this.getFurthestMeasurement(l,a),r=s?s.end+this.options.gap:t+n,c=o.get(e),d="number"==typeof c?c:this.options.estimateSize(a),u=r+d,m=s?s.lane:a%this.options.lanes;l[a]={index:a,start:r,size:d,end:u,key:e,lane:m}}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=J(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,n,i)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:n,lanes:i}){const s=e.length-1,o=t=>e[t].start;if(e.length<=i)return{startIndex:0,endIndex:s};let r=ce(0,s,o,n),l=r;if(1===i)for(;l<s&&e[l].end<n+t;)l++;else if(i>1){const o=Array(i).fill(0);for(;l<s&&o.some(e=>e<n+t);){const t=e[l];o[t.lane]=t.end,l++}const a=Array(i).fill(n+t);for(;r>=0&&a.some(e=>e>=n);){const t=e[r];a[t.lane]=t.start,r--}r=Math.max(0,r-r%i),l=Math.min(s,l+(i-1-l%i))}return{startIndex:r,endIndex:l}}({measurements:e,outerSize:t,scrollOffset:n,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=J(()=>{let e=null,t=null;const n=this.calculateRange();return n&&(e=n.startIndex,t=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,n,i,s)=>null===i||null===s?[]:e({startIndex:i,endIndex:s,overscan:t,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,n=e.getAttribute(t);return n?parseInt(n,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const n=this.indexFromElement(e),i=this.measurementsCache[n];if(!i)return;const s=i.key,o=this.elementsCache.get(s);o!==e&&(o&&this.observer.unobserve(o),this.observer.observe(e),this.elementsCache.set(s,e)),e.isConnected&&this.resizeItem(n,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{const n=this.measurementsCache[e];if(!n)return;const i=t-(this.itemSizeCache.get(n.key)??n.size);0!==i&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(n,i,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=J(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{const n=[];for(let i=0,s=e.length;i<s;i++){const s=t[e[i]];n.push(s)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const t=this.getMeasurements();if(0!==t.length)return G(t[ce(0,t.length-1,e=>G(t[e]).start,e)])},this.getOffsetForAlignment=(e,t,n=0)=>{const i=this.getSize(),s=this.getScrollOffset();"auto"===t&&(t=e>=s+i?"end":"start"),"center"===t?e+=(n-i)/2:"end"===t&&(e-=i);const o=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(o,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const n=this.measurementsCache[e];if(!n)return;const i=this.getSize(),s=this.getScrollOffset();if("auto"===t)if(n.end>=s+i-this.options.scrollPaddingEnd)t="end";else{if(!(n.start<=s+this.options.scrollPaddingStart))return[s,t];t="start"}const o="end"===t?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(o,t,n.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:n})},this.scrollToIndex=(e,{align:t="auto",behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let i=0;const s=t=>{if(!this.targetWindow)return;const i=this.getOffsetForIndex(e,t);if(!i)return void console.warn("Failed to get offset for index:",e);const[s,r]=i;this._scrollToOffset(s,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const t=this.getScrollOffset(),n=this.getOffsetForIndex(e,r);var i,s;n?(i=n[0],s=t,Math.abs(i-s)<1.01||o(r)):console.warn("Failed to get offset for index:",e)})},o=t=>{this.targetWindow&&(i++,i<10?this.targetWindow.requestAnimationFrame(()=>s(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};s(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;const t=this.getMeasurements();let n;if(0===t.length)n=this.options.paddingStart;else if(1===this.options.lanes)n=(null==(e=t[t.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let i=t.length-1;for(;i>=0&&e.some(e=>null===e);){const n=t[i];null===e[n.lane]&&(e[n.lane]=n.end),i--}n=Math.max(...e.filter(e=>null!==e))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const ce=(e,t,n,i)=>{for(;e<=t;){const s=(e+t)/2|0,o=n(s);if(o<i)e=s+1;else{if(!(o>i))return s;t=s-1}}return e>0?e-1:0};const de="undefined"!=typeof document?t.useLayoutEffect:t.useEffect;function ue(e){return function(e){const i=t.useReducer(()=>({}),{})[1],s={...e,onChange:(t,s)=>{var o;s?n.flushSync(i):i(),null==(o=e.onChange)||o.call(e,t,s)}},[o]=t.useState(()=>new ae(s));return o.setOptions(s),de(()=>o._didMount(),[]),de(()=>o._willUpdate()),o}({observeElementRect:ne,observeElementOffset:oe,scrollToFn:le,...e})}function me({sellers:n,buyers:i,selectedRegion:s,locationInfoMap:u,activeTab:m,setActiveTab:h,itemName:g}){const[f,p]=t.useState({seller:null,buyer:null}),[j,N]=t.useState({seller:{},buyer:{}}),[k,C]=t.useState({seller:{},buyer:{}}),[I,z]=t.useState(new Set),E=t.useRef(null),[M,_]=t.useState({sellerSorting:[{id:"price",desc:!1}],buyerSorting:[{id:"price",desc:!0}],sellerSizing:{},buyerSizing:{},sellerColumnFilters:[],buyerColumnFilters:[]}),D=t.useRef(),R=t.useRef();t.useEffect(()=>{const e=e=>{E.current&&!E.current.contains(e.target)&&(p(e=>({...e,seller:null,buyer:null})),C(e=>({...e,seller:{},buyer:{}})))};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[]);const A=(e,t,n)=>{if(!n||0===n.length)return!0;let i=e.getValue(t);if("security"===t){i=`${d(Number(i)||0).toFixed(1)}`}else if("station_type"===t){const t=Number(e.original.location_id);i=u[t]?.isNPC??t<1e12?"NPC":"Player"}else if("location_name"===t){const e=u[Number(i)];i=a(e?.name||"")}else if("region_name"===t){const e=u[Number(i)];i=a(e?.regionName||"")}else"range"===t&&(i=r(i));return n.includes(String(i))},F=async(e,t)=>{const n=u[Number(e)],i=n?.name;if(!i)return;await(async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){return console.error("Failed to copy text: ",t),!1}})(i)&&(z(e=>new Set(e).add(t)),setTimeout(()=>{z(e=>{const n=new Set(e);return n.delete(t),n})},2e3))},O=(e,t)=>{const n=new Set;return e.forEach(e=>{if("security"===t){const t=u[Number(e.location_id)]?.security;if(null!=t){const e=d(t);n.add(`${e.toFixed(1)}`)}}else if("station_type"===t){const t=Number(e.location_id),i=u[t]?.isNPC??t<1e12;n.add(i?"NPC":"Player")}else if("location_name"===t){const t=u[Number(e.location_id)]?.name;t&&n.add(a(t))}else if("region_name"===t){const t=u[Number(e.location_id)]?.regionName;t&&n.add(a(t))}else"range"===t&&n.add(r(e[t]))}),Array.from(n).sort()},L=e=>{p(t=>({...t,[e]:null})),C(t=>({...t,[e]:{}}))},T=t.useMemo(()=>{if(!s||"all"===s.regionID)return n||[];const e=s.regionName;return(n||[]).filter(t=>{const n=u[Number(t.location_id)];return(n?.regionName||"Unknown")===e})},[n,s,u]),V=t.useMemo(()=>{if(!s||"all"===s.regionID)return i||[];const e=s.regionName;return(i||[]).filter(t=>{const n=u[Number(t.location_id)];return(n?.regionName||"Unknown")===e})},[i,s,u]),P=t.useMemo(()=>[{accessorKey:"volume_remain",header:"Quantity",size:96},{accessorKey:"price",header:"Price",cell:e=>o(e.getValue()),size:160},{accessorKey:"range",header:"Range",cell:e=>r(e.getValue()),size:84},{accessorFn:e=>{const t=u[Number(e.location_id)]?.security;return null==t?null:t},id:"security",header:"Sec.",cell:t=>{const n=Number(t.row.original.location_id),i=u[n]?.security;return"number"==typeof i?e.jsx("span",{style:{color:l(i)},children:i.toFixed(1)}):e.jsx("span",{children:"—"})},size:78},{accessorFn:e=>{const t=Number(e.location_id);return u[t]?.isNPC??t<1e12?"NPC":"Player"},id:"station_type",header:"Type",cell:t=>{const n=t.getValue();return e.jsx("span",{style:{color:"NPC"===n?"#4CAF50":"#2196F3",fontWeight:"500"},children:n})},size:65},{accessorKey:"location_id",id:"location_name",header:"Location",cell:t=>{const n=Number(t.getValue()),i=a(u[n]?.name||"Unknown"),s=`${t.column.id}-${t.row.id}`,o=I.has(s);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{cursor:"pointer"},onClick:()=>F(n,s),title:"Click to copy location name",children:i}),o&&e.jsx("span",{style:{fontSize:"0.8em",color:"#6dd36d"},children:"Copied"})]})},sortingFn:(e,t)=>{const n=e=>{const t=u[Number(e)];if(!t)return"zzz";return`${null===t.security||void 0===t.security?999:d(t.security)}-${(t.name||"").toLowerCase()}`},i=n(e.original.location_id),s=n(t.original.location_id);return i.localeCompare(s)},size:470},{accessorKey:"location_id",id:"region_name",header:"Region",cell:e=>{const t=u[Number(e.getValue())]?.regionName||"Unknown";return a(t)},sortingFn:(e,t)=>{const n=u[Number(e.original.location_id)]?.regionName||"",i=u[Number(t.original.location_id)]?.regionName||"";return n.localeCompare(i)},size:128},{accessorKey:"duration",header:"Expires in",cell:e=>{const t=e.row.original||{},n=t.expires_at||t.expiry||t.expiresAt||null;let i=null;if(n){const e=new Date(n);isNaN(e.getTime())||(i=e.getTime())}if(null==i){const{issued:e,duration:n}=t;if(e&&"number"==typeof n){const t=new Date(e);isNaN(t.getTime())||(i=t.getTime()+24*n*60*60*1e3)}}if(null==i&&"number"==typeof t.duration_seconds&&(i=Date.now()+1e3*t.duration_seconds),null==i)return"—";const s=i-Date.now();if(!Number.isFinite(s))return"—";const o=Math.max(Math.floor(s/6e4),0);return c(o)},size:112}],[u,I]),$=t.useMemo(()=>[{accessorKey:"min_volume",header:"Min Volume",cell:e=>(e.getValue()??0).toLocaleString(),size:80},{accessorKey:"volume_remain",header:"Quantity",size:96},{accessorKey:"price",header:"Price",cell:e=>o(e.getValue()),size:160},{accessorFn:e=>{const t=u[Number(e.location_id)]?.security;return null==t?null:t},id:"security",header:"Sec.",cell:t=>{const n=Number(t.row.original.location_id),i=u[n]?.security;return"number"==typeof i?e.jsx("span",{style:{color:l(i)},children:i.toFixed(1)}):e.jsx("span",{children:"—"})},size:78},{accessorFn:e=>{const t=Number(e.location_id);return u[t]?.isNPC??t<1e12?"NPC":"Player"},id:"station_type",header:"Type",cell:t=>{const n=t.getValue();return e.jsx("span",{style:{color:"NPC"===n?"#4CAF50":"#2196F3",fontWeight:"500"},children:n})},size:65},{accessorKey:"location_id",id:"location_name",header:"Location",cell:t=>{const n=Number(t.getValue()),i=a(u[n]?.name||"Unknown"),s=`${t.column.id}-${t.row.id}`,o=I.has(s);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{cursor:"pointer"},onClick:()=>F(n,s),title:"Click to copy location name",children:i}),o&&e.jsx("span",{style:{fontSize:"0.8em",color:"#6dd36d"},children:"Copied"})]})},sortingFn:(e,t)=>{const n=e=>{const t=u[Number(e)];if(!t)return"zzz";return`${null===t.security||void 0===t.security?999:d(t.security)}-${(t.name||"").toLowerCase()}`},i=n(e.original.location_id),s=n(t.original.location_id);return i.localeCompare(s)},size:470},{accessorKey:"location_id",id:"region_name",header:"Region",cell:e=>{const t=u[e.getValue()]?.regionName||"Unknown";return a(t)},sortingFn:(e,t)=>{const n=u[Number(e.original.location_id)]?.regionName||"",i=u[Number(t.original.location_id)]?.regionName||"";return n.localeCompare(i)},size:128},{accessorKey:"range",header:"Range",cell:e=>r(e.getValue()),size:84},{accessorKey:"duration",header:"Expires in",cell:e=>{const t=e.row.original||{},n=t.expires_at||t.expiry||t.expiresAt||null;let i=null;if(n){const e=new Date(n);isNaN(e.getTime())||(i=e.getTime())}if(null==i){const{issued:e,duration:n}=t;if(e&&"number"==typeof n){const t=new Date(e);isNaN(t.getTime())||(i=t.getTime()+24*n*60*60*1e3)}}if(null==i&&"number"==typeof t.duration_seconds&&(i=Date.now()+1e3*t.duration_seconds),null==i)return"—";const s=i-Date.now();if(!Number.isFinite(s))return"—";const o=Math.max(Math.floor(s/6e4),0);return c(o)},size:112}],[u,I]),W=(e,t,n,i,s)=>{const o=(e,t)=>{_(n=>({...n,[t]:"function"==typeof e?e(n[t]):e}))};return y({data:e,columns:t,defaultColumn:{minSize:60,maxSize:600,size:void 0,enableResizing:!0,enableColumnFilter:!0,filterFn:A},columnResizeMode:"onChange",getCoreRowModel:w(),getSortedRowModel:S(),getFilteredRowModel:v(),getExpandedRowModel:x(),state:{sorting:M[n],columnSizing:M[i],columnFilters:M[s]},enableSortingRemoval:!1,onSortingChange:e=>o(e,n),onColumnSizingChange:e=>o(e,i),onColumnFiltersChange:e=>o(e,s),getRowId:e=>{const t=e.order_id??`${e.is_buy_order?"B":"S"}-${e.type_id}-${e.region_id??"r"}-${e.location_id??"l"}-${e.price}`;return String(t)}})},K=W(T,P,"sellerSorting","sellerSizing","sellerColumnFilters"),q=W(V,$,"buyerSorting","buyerSizing","buyerColumnFilters"),X=e=>{if(!e||0===e.length)return null;const t=e.reduce((e,t)=>e+(t.volume_remain??0),0),n=e.reduce((e,t)=>e+(t.price??0)*(t.volume_remain??0),0);return t>0?n/t:null},Q=t.useMemo(()=>X(T),[T]),J=t.useMemo(()=>X(V),[V]);ue({count:K.getRowModel().rows.length,getScrollElement:()=>D.current,estimateSize:()=>24,overscan:5,initialOffset:0,getItemKey:e=>K.getRowModel().rows[e]?.id??e}),ue({count:q.getRowModel().rows.length,getScrollElement:()=>R.current,estimateSize:()=>24,overscan:5,initialOffset:0,getItemKey:e=>q.getRowModel().rows[e]?.id??e});const G=(t,n)=>{const i="seller"===t?K:q;if(f[t]!==n)return null;const s="seller"===t?T:V;return e.jsxs("div",{className:"filter-panel-enhanced",ref:E,children:[e.jsx("div",{className:"filter-search-section",children:e.jsx("input",{type:"text",placeholder:"Search...",className:"filter-search-input",value:j[t]?.[n]||"",onChange:e=>{const i=e.target.value;N(e=>({...e,[t]:{...e[t],[n]:i}}))}})}),e.jsx("div",{className:"filter-options-list",children:(()=>{const i=O(s,n),o=k[t]?.[n],r=j[t]?.[n]||"",l=i.filter(e=>!r||e.toLowerCase().includes(r.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"filter-select-all-option",children:[e.jsx("input",{type:"checkbox",checked:o?.selectAll||!1,onChange:e=>{const s=e.target.checked;C(e=>({...e,[t]:{...e[t],[n]:{selectAll:s,selectedValues:s?new Set(i):new Set}}}))}}),"(Select All)"]}),l.map(s=>{const r=o?.selectedValues?.has(s)||!1;return e.jsxs("label",{className:"filter-option",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:e=>{const r=new Set(o?.selectedValues||[]);e.target.checked?r.add(s):r.delete(s);const l=r.size===i.length;C(e=>({...e,[t]:{...e[t],[n]:{selectAll:l,selectedValues:r}}}))}}),s]},s)})]})})()}),e.jsxs("div",{className:"filter-actions",children:[e.jsxs("button",{className:"filter-cancel-btn",onClick:()=>L(t),children:[e.jsx(H,{})," Cancel"]}),e.jsxs("button",{className:"filter-ok-btn",onClick:()=>((e,t,n)=>{const i=k[e]?.[t];if(!i)return;const s=O("seller"===e?T:V,t),o=Array.from(i.selectedValues),r=o.length===s.length?[]:o;n.getColumn(t).setFilterValue(r),p(t=>({...t,[e]:null})),C(n=>({...n,[e]:{...n[e],[t]:void 0}}))})(t,n,i),children:[e.jsx(U,{})," OK"]})]})]})},Y=(t,n,i)=>({column:s})=>{const o=["security","station_type","region_name","location_name","range"].includes(s.id),r=f[n]===s.id;return e.jsxs("div",{className:"header-with-filter",children:[e.jsxs("span",{className:"header-text",onClick:()=>{const e=s.getIsSorted();e?"asc"===e?s.toggleSorting(!0):s.clearSorting():s.toggleSorting(!1)},style:{cursor:"pointer"},children:[t,"asc"===s.getIsSorted()?" ▲":"desc"===s.getIsSorted()?" ▼":""]}),o&&e.jsx("button",{className:"filter-button",onClick:e=>{e.stopPropagation(),r?L(n):((e,t,n)=>{const i=n.getColumn(t).getFilterValue()||[],s=O("seller"===e?T:V,t),o=0===i.length;C(n=>({...n,[e]:{...n[e],[t]:{selectAll:o,selectedValues:o?new Set(s):new Set(i)}}})),p(n=>({...n,[e]:t}))})(n,s.id,i)},title:"Filter column",children:e.jsx(B,{})})]})},Z=(t,n,i,s,o)=>e.jsxs("div",{className:"market-table-wrapper",children:[e.jsxs("h3",{className:"market-table-title",children:[t," (",n.getRowModel().rows.length," orders)","seller"===o&&null!==Q&&e.jsxs("span",{style:{marginLeft:"1rem",fontWeight:"normal",fontSize:"0.95em",color:"#ccc"},children:["Avg Price: ",Q.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ISK"]}),"buyer"===o&&null!==J&&e.jsxs("span",{style:{marginLeft:"1rem",fontWeight:"normal",fontSize:"0.95em",color:"#ccc"},children:["Avg Price: ",J.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ISK"]})]}),e.jsxs("div",{className:"market-table",children:[e.jsx("div",{className:"thead",children:n.getHeaderGroups().map(t=>e.jsx("div",{className:"thead-row",children:t.headers.map(t=>e.jsxs("div",{className:"column-header-wrapper",children:[e.jsxs("div",{className:"column-header",style:{width:t.getSize()},children:[t.column.columnDef.Header?b(t.column.columnDef.Header,t.getContext()):Y(t.column.columnDef.header,o,n)(t.getContext()),t.column.getCanResize()&&e.jsx("div",{onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler(),className:"resizer "+(t.column.getIsResizing()?"isResizing":"")})]}),G(o,t.column.id)]},t.id))},t.id))}),e.jsx("div",{ref:i,className:"table-body",children:e.jsx("div",{style:{height:s.getTotalSize(),position:"relative"},children:s.getVirtualItems().map(t=>{const i=n.getRowModel().rows[t.index];return e.jsx("div",{className:"table-row",style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${t.start}px)`},children:i.getVisibleCells().map(t=>e.jsx("div",{className:"table-cell",style:{width:t.column.getSize(),whiteSpace:"nowrap"},children:b(t.column.columnDef.cell,t.getContext())},t.id))},i.id)})})})]})]}),ee=t.useMemo(()=>P.map(e=>({...e,Header:(["security","region_name","location_name","range"].includes(e.id),Y(e.header,"seller",K))})),[P,K]),te=t.useMemo(()=>$.map(e=>({...e,Header:(["security","region_name","location_name","range"].includes(e.id),Y(e.header,"buyer",q))})),[$,q,V]),ne=y({data:T,columns:ee,defaultColumn:{minSize:60,maxSize:600,size:void 0,enableResizing:!0,enableColumnFilter:!0,filterFn:A},columnResizeMode:"onChange",getCoreRowModel:w(),getSortedRowModel:S(),getFilteredRowModel:v(),getExpandedRowModel:x(),state:{sorting:M.sellerSorting,columnSizing:M.sellerSizing,columnFilters:M.sellerColumnFilters},enableSortingRemoval:!1,onSortingChange:e=>_(t=>({...t,sellerSorting:"function"==typeof e?e(t.sellerSorting):e})),onColumnSizingChange:e=>_(t=>({...t,sellerSizing:"function"==typeof e?e(t.sellerSizing):e})),onColumnFiltersChange:e=>_(t=>({...t,sellerColumnFilters:"function"==typeof e?e(t.sellerColumnFilters):e})),getRowId:e=>{const t=e.order_id??`${e.is_buy_order?"B":"S"}-${e.type_id}-${e.region_id??"r"}-${e.location_id??"l"}-${e.price}`;return String(t)}}),ie=y({data:V,columns:te,defaultColumn:{minSize:60,maxSize:600,size:void 0,enableResizing:!0,enableColumnFilter:!0,filterFn:A},columnResizeMode:"onChange",getCoreRowModel:w(),getSortedRowModel:S(),getFilteredRowModel:v(),getExpandedRowModel:x(),state:{sorting:M.buyerSorting,columnSizing:M.buyerSizing,columnFilters:M.buyerColumnFilters},enableSortingRemoval:!1,onSortingChange:e=>_(t=>({...t,buyerSorting:"function"==typeof e?e(t.buyerSorting):e})),onColumnSizingChange:e=>_(t=>({...t,buyerSizing:"function"==typeof e?e(t.buyerSizing):e})),onColumnFiltersChange:e=>_(t=>({...t,buyerColumnFilters:"function"==typeof e?e(t.buyerColumnFilters):e})),getRowId:e=>{const t=e.order_id??`${e.is_buy_order?"B":"S"}-${e.type_id}-${e.region_id??"r"}-${e.location_id??"l"}-${e.price}`;return String(t)}}),se=ue({count:ne.getRowModel().rows.length,getScrollElement:()=>D.current,estimateSize:()=>24,overscan:5,initialOffset:0,getItemKey:e=>ne.getRowModel().rows[e]?.id??e}),oe=ue({count:ie.getRowModel().rows.length,getScrollElement:()=>R.current,estimateSize:()=>24,overscan:5,initialOffset:0,getItemKey:e=>ie.getRowModel().rows[e]?.id??e});return e.jsxs(e.Fragment,{children:[Z("Sellers",ne,D,se,"seller"),Z("Buyers",ie,R,oe,"buyer")]})}function he({orders:n=[],regions:i=[],onRegionClick:s,selectedRegion:o}){if("all"!==o?.regionID)return e.jsxs("div",{style:{width:"100%",height:400,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a1a",color:"#fff",border:"1px solid #333"},children:[e.jsx("p",{children:'Market distribution chart is only available when "All Regions" is selected.'}),e.jsxs("p",{style:{marginTop:"10px",fontSize:"0.9em",opacity:.7},children:["Current selection: ",o?.regionName||"None"]}),e.jsx("p",{style:{marginTop:"10px",fontSize:"0.9em",opacity:.7},children:'Select "All Regions" from the region dropdown to view market distribution across regions.'})]});const r=t.useMemo(()=>{if(!n||0===n.length)return[];const e=n.map(e=>e.price).filter(e=>e>0&&!isNaN(e));if(0===e.length)return[];e.sort((e,t)=>e-t);const t=Math.floor(.01*e.length),i=Math.floor(.99*e.length),s=Math.max(0,t),o=Math.min(e.length-1,i),r=e[s],l=e[o];return n.filter(e=>{const t=e.price,n=e.volume_remain,i=t>=r&&t<=l,s=n>0,o=e.regionName&&"Unknown"!==e.regionName;return i&&s&&o})},[n]),l=t.useMemo(()=>{if(!i||0===i.length)return[];const e={};i.forEach(t=>{const n=t.regionName||t.name;n&&(e[n]={region:n,buyerVolume:0,sellerVolume:0,buyerCount:0,sellerCount:0})}),r.forEach(t=>{const n=t.regionName;e[n]||(e[n]={region:n,buyerVolume:0,sellerVolume:0,buyerCount:0,sellerCount:0});const i=e[n];t.is_buy_order?(i.buyerVolume+=t.volume_remain||0,i.buyerCount+=1):(i.sellerVolume+=t.volume_remain||0,i.sellerCount+=1)});return Object.values(e).sort((e,t)=>e.region.localeCompare(t.region))},[r,i]);t.useEffect(()=>{l.length>0&&console.log("📊 Top 3 regions by volume:",l.slice(0,3).map(e=>({region:e.region,totalVolume:e.buyerVolume+e.sellerVolume,sellers:e.sellerVolume,buyers:e.buyerVolume}))),n.length>0&&r.length,r.length>0&&0===l.length&&(console.log("⚠️ ISSUE: Filtered orders exist but no chart data generated"),console.log("Available region names in orders:",[...new Set(r.map(e=>e.regionName))]),console.log("Available region names in regions:",i.map(e=>e.regionName||e.name)))},[l,n,r,i]);const a=({active:t,payload:n,label:i})=>t&&n&&n.length?e.jsxs("div",{style:{backgroundColor:"#2a2a2a",border:"1px solid #444",borderRadius:"4px",padding:"10px",color:"#fff"},children:[e.jsx("p",{style:{margin:"0 0 5px 0",fontWeight:"bold"},children:i}),n.map((t,n)=>e.jsxs("p",{style:{margin:"2px 0",color:t.color,fontSize:"12px"},children:[t.name,": ",t.value?.toLocaleString()||0]},n))]}):null;return l&&0!==l.length?e.jsxs("div",{style:{width:"100%",height:400,background:"#1a1a1a",border:"1px solid #333",padding:"10px"},children:[e.jsxs("div",{style:{color:"#fff",marginBottom:"10px",fontSize:"12px"},children:["Showing data for ",l.length," regions with market activity"]}),e.jsx(j,{width:"100%",height:"90%",children:e.jsxs(N,{data:l,margin:{top:20,right:50,left:50,bottom:80},children:[e.jsx(k,{dataKey:"region",angle:-45,textAnchor:"end",interval:0,height:100,fontSize:10,stroke:"#ccc"}),e.jsx(C,{yAxisId:"left",orientation:"left",stroke:"#2ca02c",fontSize:10,label:{value:"Seller Volume (Supply)",angle:-90,position:"insideLeft",style:{textAnchor:"middle"}}}),e.jsx(C,{yAxisId:"right",orientation:"right",stroke:"#ff7f0e",fontSize:10,label:{value:"Buyer Volume (Demand)",angle:90,position:"insideRight",style:{textAnchor:"middle"}}}),e.jsx(I,{content:e.jsx(a,{})}),e.jsx(z,{payload:[{value:"Seller Volume (Supply)",type:"rect",color:"#2ca02c",id:"sellerVolume"},{value:"Buyer Volume (Demand)",type:"line",color:"#ff7f0e",id:"buyerVolume"}],verticalAlign:"top",height:36,wrapperStyle:{color:"#fff",fontSize:"12px"}}),e.jsx(E,{yAxisId:"left",dataKey:"sellerVolume",fill:"#2ca02c",name:"Seller Volume (Supply)",onClick:e=>{s&&e?.region&&s(e.region)},cursor:"pointer"}),e.jsx(M,{yAxisId:"right",type:"monotone",dataKey:"buyerVolume",stroke:"#ff7f0e",strokeWidth:2,name:"Buyer Volume (Demand)",dot:{r:3,fill:"#ff7f0e"},activeDot:{r:5,fill:"#ff7f0e"}})]})})]}):e.jsxs("div",{style:{width:"100%",height:400,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a1a",color:"#fff",border:"1px solid #333"},children:[e.jsx("h3",{children:"No Market Data Available"}),e.jsxs("div",{style:{textAlign:"left",fontSize:"12px",opacity:.7,marginTop:"20px"},children:[e.jsx("p",{children:"Debug Info:"}),e.jsxs("p",{children:["• Raw orders: ",n?.length||0]}),e.jsxs("p",{children:["• Filtered orders: ",r.length]}),e.jsxs("p",{children:["• Regions: ",i?.length||0]}),e.jsxs("p",{children:["• Chart data points: ",l.length]}),r.length>0&&e.jsxs("p",{children:["• Sample order region: ",r[0]?.regionName||"Unknown"]})]})]})}function ge({selectedItem:n,selectedRegion:i,setActiveTab:s}){const[o,r]=t.useState([]),[l,a]=t.useState(0),[c,d]=t.useState(30),[u,m]=t.useState(!1),[h,g]=t.useState(null),f=t.useRef(null),p=t.useRef(null),y=t.useRef({type:null,startX:0,initialStartIndex:0,initialEndIndex:0});function b(e,t){e.preventDefault(),e.stopPropagation(),y.current={type:t,startX:e.clientX,initialStartIndex:l,initialEndIndex:c},document.body.style.cursor="move"===t?"grabbing":"ew-resize",window.addEventListener("mousemove",x),window.addEventListener("mouseup",v)}function x(e){if(!y.current.type||!f.current||0===o.length)return;const t=e.clientX-y.current.startX,n=f.current.offsetWidth,i=Math.round(t/n*o.length);let s=y.current.initialStartIndex,r=y.current.initialEndIndex;if("move"===y.current.type){const e=r-s;s=Math.max(0,Math.min(o.length-e,s+i)),r=s+e}else"resize-left"===y.current.type?(s=Math.max(0,Math.min(r-1,s+i)),r-s>365&&(s=r-365)):"resize-right"===y.current.type&&(r=Math.min(o.length,Math.max(s+1,r+i)),r-s>365&&(r=s+365));a(s),d(r)}function v(){document.body.style.cursor="",window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",v),y.current={type:null,startX:0,initialStartIndex:0,initialEndIndex:0}}if(t.useEffect(()=>{if(!n)return r([]),void g("No item selected");let e=!1;return m(!0),g(null),async function(){try{let t;const s=!i||"all"===i.regionID;if(s?(console.log("📊 Loading universe market history for:",n.typeName),t=await R(n.typeID)):(console.log("📊 Loading region market history for:",n.typeName,"Region:",i.regionName),t=await A(n.typeID,i.regionID)),e)return;r(t||[]),console.log("📊 Market history loaded:",{dataLength:t?.length||0,isAllRegions:s,region:i?.regionName||"All Regions"});const o=t?.length||0,l=Math.min(30,o||0),c=Math.max(0,o-l),u=o;a(c),d(u)}catch(t){if(e)return;console.error("❌ Failed to load market history:",t),g(t.message||"Failed to load market history")}finally{e||m(!1)}}(),()=>{e=!0}},[n,i]),u)return e.jsx("div",{style:{width:"100%",height:500,display:"flex",alignItems:"center",justifyContent:"center",background:"#1a1a1a",color:"#fff",border:"1px solid #333"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{children:"Loading universe market history..."}),e.jsxs("div",{style:{fontSize:"12px",opacity:.7,marginTop:"10px"},children:["Item: ",n?.typeName||"Unknown"]})]})});if(h)return e.jsx("div",{style:{width:"100%",height:500,display:"flex",alignItems:"center",justifyContent:"center",background:"#1a1a1a",color:"#fff",border:"1px solid #333"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{color:"#ff6b6b"},children:"Error loading universe market history"}),e.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"10px"},children:h}),e.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"10px"},children:["Debug: Item=",n?.typeName]})]})});if(!o.length)return e.jsx("div",{style:{width:"100%",height:500,display:"flex",alignItems:"center",justifyContent:"center",background:"#1a1a1a",color:"#fff",border:"1px solid #333"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{children:"No market history available"}),e.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"10px"},children:"This could be due to:"}),e.jsxs("ul",{style:{fontSize:"12px",opacity:.7,textAlign:"left",marginTop:"5px"},children:[e.jsx("li",{children:"Item not actively traded"}),e.jsx("li",{children:"API service unavailable"}),e.jsx("li",{children:"Network connectivity issues"}),e.jsx("li",{children:"Invalid item data"})]}),e.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"10px"},children:["Debug: Item=",n?.typeName]})]})});const S=Math.max(0,Math.min(l,o.length-1)),w=Math.max(S+1,Math.min(c,o.length)),F=o.slice(S,w),O=!i||"all"===i.regionID?"All Regions (Universe)":i.regionName,L=({active:t,payload:n,label:i})=>t&&n&&n.length?e.jsxs("div",{style:{backgroundColor:"#2a2a2a",border:"1px solid #444",borderRadius:"4px",padding:"10px",color:"#fff"},children:[e.jsx("p",{style:{margin:"0 0 5px 0",fontWeight:"bold"},children:i}),n.map((t,n)=>e.jsxs("p",{style:{margin:"2px 0",color:t.color,fontSize:"12px"},children:[t.name,": ",t.value?.toLocaleString()||"N/A"]},n))]}):null;return e.jsxs("div",{style:{width:"100%",height:500,background:"#1a1a1a",border:"1px solid #333",padding:"10px"},children:[e.jsxs("div",{style:{color:"#fff",marginBottom:"10px",fontSize:"12px"},children:["Market History: ",n?.typeName," - ",O," | Showing ",F.length," of ",o.length," days | Range: ",S,"-",w,o.length<7&&o.length>0&&e.jsxs("span",{style:{color:"#ffa500",marginLeft:"10px"},children:["⚠️ Limited market data available (",o.length," day",1===o.length?"":"s",")"]}),0===o.length&&e.jsx("span",{style:{color:"#ff6b6b",marginLeft:"10px"},children:"❌ No market history data available"})]}),e.jsx(j,{width:"100%",height:380,children:e.jsxs(N,{data:F,margin:{top:20,right:50,left:50,bottom:50},children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#444"}),e.jsx(k,{dataKey:"date",angle:-45,textAnchor:"end",interval:Math.max(0,Math.floor(F.length/10)),stroke:"#ccc",fontSize:10}),e.jsx(C,{yAxisId:"left",label:{value:"Avg Price (ISK)",angle:-90,position:"insideLeft",style:{textAnchor:"middle"}},tickFormatter:e=>e?e.toLocaleString():"",domain:["auto","auto"],stroke:"#1f77b4",fontSize:10}),e.jsx(C,{yAxisId:"right",orientation:"right",label:{value:"Volume",angle:90,position:"insideRight",style:{textAnchor:"middle"}},tickFormatter:e=>e?e.toLocaleString():"",domain:[0,"auto"],stroke:"#8884d8",fontSize:10}),e.jsx(I,{content:e.jsx(L,{})}),e.jsx(z,{verticalAlign:"top",height:36,wrapperStyle:{color:"#fff",fontSize:"12px"}}),e.jsx(M,{yAxisId:"left",type:"monotone",dataKey:"average",stroke:"#1f77b4",strokeWidth:2,dot:!1,name:"Average Price"}),e.jsx(E,{yAxisId:"right",dataKey:"totalVolume",fill:"#8884d8",barSize:Math.max(1,Math.min(20,300/F.length)),opacity:.4,name:"Volume"})]})}),e.jsxs("div",{ref:f,style:{position:"relative",height:60,marginTop:10,background:"#555",border:"1px solid #666",overflow:"hidden",userSelect:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,zIndex:1},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsx(N,{data:o,children:e.jsx(D,{type:"monotone",dataKey:"totalVolume",stroke:"#8884d8",fill:"#8884d8",opacity:.3})})})}),e.jsxs("div",{ref:p,style:{position:"absolute",top:0,left:S/o.length*100+"%",width:(w-S)/o.length*100+"%",height:"100%",background:"rgba(100, 149, 237, 0.3)",border:"2px solid #6495ED",borderRadius:4,boxShadow:"0 0 4px rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"move"===y.current.type?"grabbing":"grab",zIndex:2,transition:y.current.type?"none":"all 0.1s ease"},onMouseDown:e=>b(e,"move"),children:[e.jsx("div",{style:{width:8,height:"100%",cursor:"ew-resize",background:"#6495ED",borderRadius:"4px 0 0 4px",transition:"background-color 0.2s ease"},onMouseDown:e=>b(e,"resize-left"),onMouseEnter:e=>e.target.style.backgroundColor="#4169E1",onMouseLeave:e=>e.target.style.backgroundColor="#6495ED"}),e.jsxs("div",{style:{position:"absolute",top:4,right:8,background:"rgba(0,0,0,0.8)",color:"#fff",padding:"2px 6px",borderRadius:4,fontSize:12,pointerEvents:"none"},children:[w-S,"d"]}),e.jsx("div",{style:{width:8,height:"100%",cursor:"ew-resize",background:"#6495ED",borderRadius:"0 4px 4px 0",transition:"background-color 0.2s ease"},onMouseDown:e=>b(e,"resize-right"),onMouseEnter:e=>e.target.style.backgroundColor="#4169E1",onMouseLeave:e=>e.target.style.backgroundColor="#6495ED"})]})]})]})}function fe({regionsData:n,filterOutliers:i}){const s=t.useRef(null),[o,r]=t.useState(null);return t.useEffect(()=>{n&&async function(e,t=!0){try{const e=44992,i=19000001;let s=[];try{const t=await F(e,i);s=[...t.sellOrders||[],...t.buyOrders||[]]}catch(n){return console.warn(`Failed to fetch PLEX orders from region ${i}:`,n),{name:"PLEX",highestBuy:null,lowestSell:null,averageSell:null}}const o=s.filter(e=>!e.is_buy_order),r=s.filter(e=>e.is_buy_order),l=u(o,t),a=u(r,t),c=(e=>{if(!e||0===e.length)return null;const t=e.reduce((e,t)=>e+t.volume_remain,0),n=e.reduce((e,t)=>e+t.price*t.volume_remain,0);return t>0?n/t:null})(l);return{name:"PLEX",highestBuy:a.length>0?Math.max(...a.map(e=>e.price)):null,lowestSell:l.length>0?Math.min(...l.map(e=>e.price)):null,averageSell:c}}catch(n){throw console.error("Failed to fetch PLEX stats:",n),n}}(0,i).then(e=>{r(e)}).catch(e=>console.error("❌ PLEX ticker fetch failed:",e))},[n,i]),t.useEffect(()=>{if(!o||!s.current)return;const e=s.current;e.innerHTML="";const t=document.createElement("div");t.className="marquee__item";const n=[{label:"Highest Buy",value:o.highestBuy,className:"highest"},{label:"Lowest Sell",value:o.lowestSell,className:"lowest"},{label:"Average Sell",value:o.averageSell,className:"average"}].filter(e=>null!==e.value);if(n.forEach(({label:e,value:n,className:i})=>{const s=document.createElement("span");s.className=`marquee__text ${i}`,s.textContent=`PLEX — ${e}: ${(e=>`${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} ISK`)(n)} • `,t.appendChild(s)}),0===n.length){const e=document.createElement("span");e.className="marquee__text",e.textContent="PLEX — Loading market data... • ",t.appendChild(e)}e.appendChild(t),e.offsetWidth;const i=t.offsetWidth,r=e.parentElement.offsetWidth,l=Math.ceil(r/i*2)+2;for(let s=1;s<l;s++)e.appendChild(t.cloneNode(!0));const a=`marquee-scroll-${Date.now()}`,c=`\n            @keyframes ${a} {\n                0% { transform: translateX(0); }\n                100% { transform: translateX(-${i}px); }\n            }\n        `,d=document.createElement("style");return d.id="marquee-keyframes",d.textContent=c,document.head.appendChild(d),e.style.animation=`${a} ${i/60}s linear infinite`,()=>{document.querySelector("#marquee-keyframes")?.remove()}},[o]),e.jsx("div",{id:"plexTicker",className:"marquee",children:e.jsx("div",{ref:s,className:"marquee__content"})})}function pe(){const[n,s]=t.useState(null),[o,r]=t.useState(null),[l,a]=t.useState({regionID:"all",regionName:"All Regions"}),[c,d]=t.useState("orders"),[p,y]=t.useState(null),[b,x]=t.useState([]),[v,S]=t.useState([]),[w,j]=t.useState("none"),[N,k]=t.useState([]),[C,I]=t.useState([]),[z,E]=t.useState([]),[M,_]=t.useState({}),D=i(),R=new URLSearchParams(D.search),A=parseInt(R.get("item")||"0",10),[O,L]=t.useState(null);t.useEffect(()=>{fetch("/EVE-Data-Site-Dev/data/market.json").then(e=>{if(!e.ok)throw new Error("Failed to load market.json");return e.json()}).then(e=>{let t=e;t&&!Array.isArray(t)&&"object"==typeof t&&(t=Object.entries(t).map(([e,t])=>({...t,name:e}))),Array.isArray(t)&&0!==t.length?(L(null),s(t)):(L("Market tree data is empty or invalid."),s(null))}).catch(()=>{L("Failed to load market tree."),s(null)})},[]);const T=t.useMemo(()=>n?m(n):{items:[],pathMap:{}},[n]);t.useEffect(()=>{h().then(k).catch(e=>console.error("❌ Failed to load regions:",e))},[]),t.useEffect(()=>{if(!N.length)return;(async()=>{const e=new Map;N.forEach(t=>e.set(Number(t.regionID),t.regionName));const t={};try{const n=await f();let i=[];Array.isArray(n)?i=n:n&&"object"==typeof n&&(i=Object.entries(n).map(([e,t])=>({station_id:Number(e),...t}))),E(i),i.forEach(n=>{const i=Number(n.station_id??n.stationID);if(!Number.isFinite(i))return;const s=n.name||n.stationName||n.locationName||"Unknown",o=n.region_name||n.regionName||e.get(Number(n.region_id??n.regionID))||"Unknown",r="number"==typeof n.security_status?n.security_status:"number"==typeof n.security?n.security:"number"==typeof n.securityStatus?n.securityStatus:null;t[i]={name:s,security:r,regionName:o,type:"station",isNPC:!0}})}catch(n){console.error("❌ Failed to load NPC stations:",n)}C.forEach(n=>{const i=Number(n.structureID??n.stationID);Number.isFinite(i)&&(t[i]={name:n.locationName||n.name||"Unknown",security:"number"==typeof n.security?n.security:null,regionName:n.regionName||e.get(Number(n.regionID))||"Unknown",type:"structure",isNPC:!1})}),console.log(`📍 Total locations (NPC + Structures): ${Object.keys(t).length}`),_(t)})()},[N,C]),t.useEffect(()=>{g().then(I).catch(e=>console.error("❌ Failed to load structures:",e))},[]);const[V,P]=t.useState(!1);t.useEffect(()=>{if(T?.items?.length&&!V)if(A){const e=T.items.find(e=>e.typeID===A);e&&(r(e),y(T.pathMap[A]),d("orders"),P(!0))}else P(!0)},[T,A,V]),t.useEffect(()=>{if(!V)return;const e=new URLSearchParams(window.location.search);if(e.has("item")){e.delete("item");const t=`${window.location.pathname}${e.toString()?"?"+e.toString():""}`;window.history.replaceState({},"",t)}},[o,V]);const $=t.useCallback(async()=>{if(o&&N.length)try{let e=[];const t=l?.regionID,n=44992,i=19000001;if(o.typeID===n){const t=await F(o.typeID,i);e=[...t.sellOrders||[],...t.buyOrders||[]].map(e=>({...e,region_id:i}))}else if(t&&"all"!==t){const n=await F(o.typeID,t);e=[...n.sellOrders||[],...n.buyOrders||[]].map(e=>({...e,region_id:e.region_id||t}))}else{const t=N.map(async e=>{try{const t=await F(o.typeID,e.regionID);return[...t.sellOrders||[],...t.buyOrders||[]].map(t=>({...t,region_id:e.regionID}))}catch{return[]}});e=(await Promise.all(t)).flat()}const s=u(e.filter(e=>!e.is_buy_order),w),r=u(e.filter(e=>e.is_buy_order),w);x(s),S(r)}catch(e){console.error("Failed to fetch market orders:",e)}},[o,l,N,w]);t.useEffect(()=>{$()},[$]),t.useEffect(()=>{const e=[...b,...v];if(0===e.length)return;const t={...M},n=new Map(N.map(e=>[Number(e.regionID),e.regionName]));let i=0;e.forEach(e=>{const s=Number(e.location_id);if(Number.isFinite(s)&&!(s<=0)&&!t[s]){const o=z.find(e=>Number(e.station_id??e.stationID)===s);if(o){const e=o.name||o.stationName||o.locationName||"Unknown",r=o.region_name||o.regionName||n.get(Number(o.region_id??o.regionID))||"Unknown",l="number"==typeof o.security_status?o.security_status:"number"==typeof o.security?o.security:"number"==typeof o.securityStatus?o.securityStatus:null;return t[s]={name:e,regionName:r,security:l,type:"station",isNPC:!0},void i++}const r=C.find(e=>Number(e.structureID??e.stationID)===s);if(r){const e=r.locationName||r.name||"Unknown",o=r.regionName||n.get(Number(r.regionID))||"Unknown",l="number"==typeof r.security?r.security:null;return t[s]={name:e,regionName:o,security:l,type:"structure",isNPC:!1},void i++}const l=e.name||e.location_name,a=e.region_name||e.regionName||n.get(Number(e.region_id))||"Unknown Region";t[s]={name:l||"Unknown Location",regionName:a,security:"number"==typeof e.security?e.security:"number"==typeof e.security_status?e.security_status:null,type:e.location_type||e.type||"unknown",isNPC:(1===e.is_npc||!0===e.isNPC)??s<1e12},i++}}),i>0&&(console.log(`📍 Added ${i} new locations from market orders`),console.log("📍 Updated locationInfoMap size:",Object.keys(t).length),_(t))},[b,v]);const W=t.useMemo(()=>{const e=[...b,...v],t=new Map(N.map(e=>[Number(e.regionID),e.regionName]));return e.map(e=>({...e,regionName:t.get(Number(e.region_id))||`Region ${e.region_id||"Unknown"}`}))},[b,v,N]);t.useEffect(()=>{const e=()=>{const e=new URLSearchParams(window.location.search).get("item");if(e&&n){const t=((e,t)=>{const n=Number(e),i=e=>{if(!e||"object"!=typeof e)return null;if(Array.isArray(e.items)){const t=e.items.find(e=>Number(e.typeID)===n);if(t)return t}for(const[t,n]of Object.entries(e))if("_info"!==t&&"items"!==t&&n&&"object"==typeof n&&!Array.isArray(n)){const e=i(n);if(e)return e}return null};if(Array.isArray(t))for(const s of t){const e=i(s);if(e)return e}else for(const[,s]of Object.entries(t))if(s&&"object"==typeof s){const e=i(s);if(e)return e}return null})(e,n);t&&r(t)}};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[n]);return e.jsxs("div",{className:"market",children:[O&&e.jsx("div",{style:{color:"red",padding:"1rem"},children:O}),e.jsxs("div",{className:"market-body",children:[e.jsx("div",{className:"left-panel",children:e.jsx(q,{selectedRegion:l,onRegionChange:a,regions:N,onItemSelect:e=>{if(r(e),window.location.search){const e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString())}d("orders")},marketTree:n,breadcrumbPath:p})}),e.jsx("div",{className:"right-panel",children:o&&!O&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{selectedItem:o,marketTree:n,onBreadcrumbClick:e=>{y(e),setTimeout(()=>{const t=e.join("/"),n=document.querySelector(`[data-path="${t}"]`);n&&n.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),e.jsxs("div",{className:"market-tabs-container",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{className:"market-tabs",children:[e.jsx("button",{className:"orders"===c?"active":"",onClick:()=>d("orders"),children:"Market Orders"}),e.jsx("button",{className:"history"===c?"active":"",onClick:()=>d("history"),children:"Market History"}),e.jsx("button",{className:"distribution"===c?"active":"",onClick:()=>d("distribution"),children:"Market Distribution"}),e.jsxs("div",{style:{marginLeft:"1rem",display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{children:"Outlier Filter: "}),e.jsxs("select",{value:w,onChange:e=>j(e.target.value),style:{padding:"2px 4px",background:"#2a2a2a",color:"#eee",border:"1px solid #444",borderRadius:"4px"},children:[e.jsx("option",{value:"none",children:"No outlier prices filtered out"}),e.jsx("option",{value:"mild",children:"5th to 95th percentile (1.5 IQR)"}),e.jsx("option",{value:"moderate",children:"10th to 90th percentile (1.0 IQR)"}),e.jsx("option",{value:"strict",children:"25th to 75th percentile (0.5 IQR)"}),e.jsx("option",{value:"ultra",children:"37.5th to 62.5th percentile (0.25 IQR)"})]})]})]}),e.jsx("div",{className:"market-tabs-right",style:{display:"flex",alignItems:"center",gap:"1rem"}})]}),"orders"===c&&Object.keys(M).length>0&&e.jsx(me,{sellers:b,buyers:v,selectedRegion:l,locationInfoMap:M,activeTab:c,setActiveTab:d,itemName:o?.typeName}),"history"===c&&e.jsx(ge,{selectedItem:o,selectedRegion:l}),"distribution"===c&&e.jsx(he,{orders:W,regions:N,selectedRegion:l,onRegionClick:e=>{const t=N?.find(t=>t.regionName===e);t&&(a({regionID:t.regionID,regionName:t.regionName}),d("orders"))}})]})})]}),e.jsx(fe,{regionsData:N,filterOutliers:w})]})}export{pe as default};
//# sourceMappingURL=Market-Cif87hRu.js.map

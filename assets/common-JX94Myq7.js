import{j as e}from"./index-CvPkk-JK.js";import{r as t}from"./react-vendor-qWGkjVPF.js";const n=`${"/EVE-Data-Site/".replace(/\/$/,"")}/data`,r="".replace(/\/$/,"")||n,o=({}.VITE_AZURE_BASE||"https://evedatafunc01.azurewebsites.net/api").replace(/\/$/,""),i="https://esi.evetech.net/latest";async function s(e,t={},n=3){for(let o=0;o<n;o++)try{const n=await fetch(e,t);if(!n.ok){await n.text();throw new Error(`HTTP ${n.status}: ${n.statusText}`)}const r=n.headers.get("content-type");if(r&&r.includes("application/json"))return await n.json();await n.text();throw new Error("Response is not JSON")}catch(r){if(o===n-1)throw r;await new Promise(e=>setTimeout(e,1e3*Math.pow(2,o)))}}async function a(e){let t;for(const r of e.filter(Boolean))try{return await s(r)}catch(n){t=n}throw t||new Error("No sources available")}function c(){return a([`${r}/market.json`,`${r}/market/market.json`])}function l(){return a([`${r}/regions.json`,`${r}/regions/regions.json`]).then(e=>{if(Array.isArray(e))return e;if(e&&Array.isArray(e.regions))return e.regions;throw new Error("Invalid regions.json format")})}function u(){return a([`${r}/structures.json`,`${r}/structures/structures.json`])}function f(){return a([`${r}/stations.json`,`${r}/stations/stations_npc.json`])}async function g(e,t){const n=Number(e),r=Number(t);if(!Number.isFinite(n)||!Number.isFinite(r))throw new Error("invalid-system-ids");const o=`${i}/route/${n}/${r}/`,s=await fetch(o,{headers:{"User-Agent":"EVE-Data-Site"}});if(!s.ok)throw new Error(`ESI route ${s.status}`);const a=await s.json();return Array.isArray(a)?Math.max(0,a.length-1):null}function h(e){const t=String(e);try{const e=`${t}.json`,n=`${o}/log/request?name=${encodeURIComponent(e)}&source=${encodeURIComponent("spa:region_orders")}`;"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon?navigator.sendBeacon(n,"1"):fetch(n,{method:"GET",mode:"no-cors",cache:"no-store",keepalive:!0}).catch(()=>{})}catch{}return fetch(`${r}/region_orders/${t}.json`).then(async e=>{if(!e.ok)throw new Error(`snapshot-missing:${e.status}`);if(!(e.headers.get("content-type")||"").includes("application/json"))throw new Error("snapshot-not-json");return e.json()})}async function p(){const{owner:e,repo:t}=function(){try{const e="sidarthus89",t="EVE-Data-Site",n=n=>{const r=new URL(n),o=r.hostname||"",i=(r.pathname||"/").split("/").filter(Boolean);return o.endsWith("github.io")&&i.length>0?{owner:o.split(".")[0]||e,repo:i[0]||t}:null};if(/^https?:\/\//i.test(r)){const e=n(r);if(e)return e}if("undefined"!=typeof window){const e=n(window.location.href);if(e)return e}return{owner:e,repo:t}}catch{return{owner:"sidarthus89",repo:"EVE-Data-Site"}}}(),n=`https://api.github.com/repos/${e}/${t}/commits?sha=gh-pages&path=data&per_page=1`;try{const e=await fetch(n,{headers:{Accept:"application/vnd.github+json"}});if(e.ok){const t=await e.json(),n=Array.isArray(t)?t[0]:null,r=n?.commit?.committer?.date||n?.commit?.author?.date;if(r)return new Date(r).toISOString()}}catch{}return null}const m=["The Forge","Domain","Heimatar","Sinq Laison","Metropolis"];function d({selectedRegion:n,onRegionChange:r,allowAllRegions:o=!0}){const[i,s]=t.useState([]),[a,c]=t.useState(null),[u,f]=t.useState(!0);t.useEffect(()=>{!async function(){try{const e=await l();if(!e||!Array.isArray(e))throw new Error("Invalid regions data format");const t=19000001,n=e.filter(e=>e.regionID!==t);s(n),c(null),f(!1)}catch(e){c(`Failed to load regions: ${e.message}`),s([]),f(!1)}}()},[]),t.useEffect(()=>{o&&(!n||!n.regionID)&&i.length>0&&r?.({regionName:"All Regions",regionID:"all"})},[n,i,r,o]);const{popularRegionsList:g,otherRegionsList:h,allRegionsList:p}=t.useMemo(()=>({popularRegionsList:i.filter(e=>m.includes(e.regionName)).sort((e,t)=>e.regionName.localeCompare(t.regionName)),otherRegionsList:i.filter(e=>!m.includes(e.regionName)).sort((e,t)=>e.regionName.localeCompare(t.regionName)),allRegionsList:i.slice().sort((e,t)=>e.regionName.localeCompare(t.regionName))}),[i]);if(a)return e.jsxs("div",{style:{color:"red",padding:"1rem"},children:["Error loading regions: ",a]});if(0===i.length){const t=u?"Loading regions...":"Discovering regions from market data...";return e.jsx("div",{style:{padding:"1rem"},children:t})}return e.jsx("div",{className:"region-selector-container",children:e.jsxs("select",{className:"region-selector",id:"region-select",value:n?.regionID||(o?"all":""),onChange:e=>{const t=e.target.value;if(!t)return void r?.(null);if("all"===t)return void r?.({regionName:"All Regions",regionID:"all"});const n=i.find(e=>String(e.regionID)===t);n&&r?.(n)},children:[!o&&e.jsx("option",{value:"",children:"*Select a Region*"}),o&&e.jsx("option",{value:"all",children:"All Regions"}),g.length>0&&e.jsx("optgroup",{label:"Popular Regions",children:g.map(t=>e.jsx("option",{value:t.regionID,children:t.regionName},t.regionID))}),e.jsx("optgroup",{label:"All Regions (Alphabetical)",children:p.map(t=>e.jsx("option",{value:t.regionID,children:t.regionName},`all-${t.regionID}`))})]})})}const w=e=>Math.floor(10*e)/10,j=e=>e?.split(" ").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")??"",y=e=>`${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} ISK`,$=e=>`${Math.floor(e/1440)}d ${Math.floor(e%1440/60)}h ${e%60}m`,E=e=>{const t=parseInt(e,10);if(-1===t)return"Station";if(0===t)return"System";if(32767===t)return"Region";if(!isNaN(t))return`${t} ${1===t?"Jump":"Jumps"}`;const n=String(e).trim().toLowerCase();return["station","system","region"].includes(n)?j(n):j(e)},v=e=>{const t=[[1,"#2e74df"],[.9,"#389cf6"],[.8,"#4acff3"],[.7,"#62daa6"],[.6,"#71e452"],[.5,"#eeff83"],[.4,"#de6a0c"],[.3,"#ce4611"],[.2,"#bb1014"],[.1,"#6d221d"],[0,"#8f2f69"]];for(const[n,r]of t)if(e>=n)return r;return"#8f2f69"},A="none",b="mild",N="moderate",R="strict",S="ultra";function D(e,t=A){if(t===A||e.length<4)return e;const n=[...e].sort((e,t)=>e.price-t.price);let r,o,i;switch(t){case b:r=.05,o=.95,i=1.5;break;case N:r=.1,o=.9,i=1;break;case R:r=.25,o=.75,i=.5;break;case S:r=.375,o=.625,i=.25;break;default:return e}const s=Math.floor(n.length*r),a=Math.floor(n.length*o),c=n[s].price,l=n[a].price,u=l-c,f=Math.max(c,c-i*u),g=l+i*u;return n.filter(e=>e.price>=f&&e.price<=g)}function I(e){const t=[];return function e(n,r=[]){for(const[o,i]of Object.entries(n))if("_info"!==o){if(Array.isArray(i?.items))for(const e of i.items)t.push({...e,categoryPath:[...r,o].join(" > ")});for(const[t,n]of Object.entries(i))"items"!==t&&"_info"!==t&&"object"==typeof n&&e({[t]:n},[...r,o])}}(e),t}export{o as A,i as E,d as R,E as a,$ as b,j as c,D as d,I as e,y as f,v as g,l as h,u as i,f as j,p as k,c as l,g as m,h as n,s as o,w as t};

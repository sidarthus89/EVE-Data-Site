import{j as e}from"./index-labcONku.js";import{r as a}from"./react-vendor-qWGkjVPF.js";import{R as t,g as s,f as i}from"./common-Dj-hq0Xi.js";import{u as l,b as r,c}from"./index-Dikt98rE.js";function o(){const[o,n]=a.useState(""),[d,u]=a.useState([]),[m,h]=a.useState(!1),[y,p]=a.useState(""),[g,x]=a.useState({regionName:"All Regions",regionID:"all"}),[b,j]=a.useState({}),[N,f]=a.useState(null),[v,S]=a.useState(new Map),[w,P]=a.useState({}),I=a.useCallback(e=>{const a={};return Object.entries(e).forEach(([e,t])=>{Object.entries(t).forEach(([t,s])=>{"regionID"!==t&&Object.entries(s).forEach(([s,i])=>{i?.stations&&Object.entries(i.stations).forEach(([l,r])=>{a[l]={name:r.locationName,security:r.security??i.security??null,region:e,system:s,constellation:t}})})})}),a},[]);a.useEffect(()=>{fetchMarketTree().then(e=>{if(f(e),e){let a=e;Array.isArray(e)||"object"!=typeof e||(a=Object.entries(e).map(([e,a])=>({...a,name:e}))),S(function(e){const a=new Map;return function e(t){if(t.items)for(const s of t.items)s.published&&s.typeName&&a.set(s.typeName.toLowerCase(),s);for(const a in t)"items"!==a&&"object"==typeof t[a]&&e(t[a])}(e),a}(a))}}).catch(e=>{})},[]),a.useEffect(()=>{fetchLocations().then(e=>{j(e),P(I(e))}).catch(e=>{})},[I]);const D=a.useMemo(()=>{const e=[{accessorKey:"name",header:"Item",cell:e=>e.getValue()},{accessorKey:"quantity",header:"Qty",cell:e=>e.getValue().toLocaleString()}];return"all"===g.regionID&&e.push({accessorKey:"regionName",header:"Region",cell:e=>e.getValue()}),e.push({accessorKey:"sellPrice",header:"Price (each)",cell:e=>e.getValue()?.toLocaleString(void 0,{maximumFractionDigits:2})},{accessorKey:"totalSell",header:"Total Value",cell:e=>(e.row.original.sellPrice*e.row.original.quantity).toLocaleString(void 0,{maximumFractionDigits:2})}),e},[g]),R=a.useMemo(()=>{const e=[{accessorKey:"name",header:"Item",cell:e=>e.getValue()},{accessorKey:"quantity",header:"Qty",cell:e=>e.getValue().toLocaleString()}];return"all"===g.regionID&&e.push({accessorKey:"regionName",header:"Region",cell:e=>e.getValue()}),e.push({accessorKey:"buyPrice",header:"Price (each)",cell:e=>e.getValue()?.toLocaleString(void 0,{maximumFractionDigits:2})},{accessorKey:"totalBuy",header:"Total Value",cell:e=>(e.row.original.buyPrice*e.row.original.quantity).toLocaleString(void 0,{maximumFractionDigits:2})}),e},[g]);return l({data:d,columns:D,getCoreRowModel:c(),getSortedRowModel:r(),debugTable:!1}),l({data:d,columns:R,getCoreRowModel:c(),getSortedRowModel:r(),debugTable:!1}),e.jsxs("div",{className:"appraisal-tool",children:[e.jsxs("div",{className:"appraisal-header",children:[e.jsx("h2",{children:"Create Appraisal"}),e.jsx("p",{className:"appraisal-description",children:"You can use this tool to appraise large sets of items. Paste lists of items from in-game sources (contracts, fits, hangars, ledgers, etc) into the box below."})]}),e.jsxs("div",{className:"appraisal-grid",children:[e.jsxs("div",{className:"input-section",children:[e.jsxs("div",{className:"control-row",children:[e.jsx("label",{children:"Region:"}),e.jsx(t,{selectedRegion:g,onRegionChange:x})]}),e.jsx("textarea",{className:"appraisal-input",rows:12,placeholder:"Paste your items here...",value:o,onChange:e=>n(e.target.value)}),e.jsxs("div",{className:"button-row",children:[e.jsx("button",{className:"reset-btn",children:"Reset"}),e.jsx("button",{className:"submit-btn",onClick:async()=>{h(!0),p(""),u([]);try{const a=o.split("\n").map(e=>e.trim()).filter(Boolean).map(e=>{const a=e.match(/^(.*?)(?:\s+x(\d+))?$/),t=a?.[1]?.trim()||"",s=parseInt(a?.[2]||"1",10),i=v.get(t.toLowerCase());return i?{name:i.typeName,quantity:s,typeID:Number(i.typeID)}:null}).filter(e=>e&&e.typeID);if(!a.length)return p("❌ No valid items found to appraise."),void h(!1);if("all"===g.regionID){const t=Object.entries(b).map(([e,a])=>({regionName:e,regionID:a.regionID})),s=[];for(const i of a)for(const{regionName:a,regionID:l}of t)try{const e=await fetchRegionOrdersByID(i.typeID,l),t=e.filter(e=>!e.is_buy_order&&e.price>0).sort((e,a)=>e.price-a.price)[0],r=e.filter(e=>e.is_buy_order&&e.price>0).sort((e,a)=>a.price-e.price)[0];s.push({...i,regionName:a,sellPrice:t?.price||0,buyPrice:r?.price||0})}catch(e){s.push({...i,regionName:a,sellPrice:0,buyPrice:0})}u(s)}else{const t=b?.[g.regionName],s=t?.regionID;if(!s)return p("❌ Invalid region selected"),void h(!1);const i=await Promise.all(a.map(async a=>{try{const e=await fetchRegionOrdersByID(a.typeID,s),t=e.filter(e=>!e.is_buy_order&&e.price>0).sort((e,a)=>e.price-a.price),i=e.filter(e=>e.is_buy_order&&e.price>0).sort((e,a)=>a.price-e.price),l=t[0],r=i[0],c=l?{locationId:l.location_id,name:w[l.location_id]?.name||"Unknown Station",security:w[l.location_id]?.security||0,region:w[l.location_id]?.region||"Unknown Region"}:null,o=r?{locationId:r.location_id,name:w[r.location_id]?.name||"Unknown Station",security:w[r.location_id]?.security||0,region:w[r.location_id]?.region||"Unknown Region"}:null;return{...a,sellPrice:l?.price||0,buyPrice:r?.price||0,sellStation:c,buyStation:o}}catch(e){return{...a,sellPrice:0,buyPrice:0}}}));u(i)}}catch(e){p("❌ Something went wrong during appraisal.")}h(!1)},disabled:!o||m,children:m?"Appraising...":"Submit"})]})]}),d.length>0&&e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"totals-banner",children:[e.jsxs("div",{className:"total-value",children:[e.jsxs("span",{className:"value",children:[d.reduce((e,a)=>e+a.sellPrice*a.quantity,0).toLocaleString("en-US",{maximumFractionDigits:1}),"k"]}),e.jsx("span",{className:"label",children:"sell estimate"})]}),e.jsxs("div",{className:"total-value",children:[e.jsxs("span",{className:"value",children:[d.reduce((e,a)=>e+a.buyPrice*a.quantity,0).toLocaleString("en-US",{maximumFractionDigits:1}),"k"]}),e.jsx("span",{className:"label",children:"buy estimate"})]}),e.jsxs("div",{className:"total-value",children:[e.jsx("span",{className:"value",children:d.reduce((e,a)=>e+a.quantity,0)}),e.jsx("span",{className:"label",children:"total volume"})]})]}),e.jsx("div",{className:"market-table-wrapper",children:e.jsxs("div",{className:"market-table",children:[e.jsx("div",{className:"thead",children:e.jsxs("div",{className:"thead-row",children:[e.jsx("div",{className:"column-header",style:{width:200},children:"Item"}),e.jsx("div",{className:"column-header",style:{width:250},children:"Quantity Location (Buy)"}),e.jsx("div",{className:"column-header",style:{width:250},children:"Price Location"}),e.jsx("div",{className:"column-header",style:{width:200},children:"Price"}),e.jsx("div",{className:"column-header",style:{width:150},children:"Total Value"})]})}),e.jsx("div",{className:"table-body",children:d.map((a,t)=>e.jsxs("div",{className:"table-row",children:[e.jsxs("div",{className:"table-cell",style:{width:200},children:[a.name," ",a.quantity.toLocaleString()]}),e.jsx("div",{className:"table-cell location-cell",style:{width:250},children:a.buyStation?e.jsxs("div",{className:"station-info",children:[e.jsx("span",{className:"sec-cell",style:{color:s(a.buyStation.security)},children:a.buyStation.security>=0?` ${a.buyStation.security.toFixed(1)}`:a.buyStation.security.toFixed(1)}),e.jsx("span",{className:"location-text",children:a.buyStation.name})]}):"---"}),e.jsx("div",{className:"table-cell location-cell",style:{width:250},children:a.sellStation?e.jsxs("div",{className:"station-info",children:[e.jsx("span",{className:"sec-cell",style:{color:s(a.sellStation.security)},children:a.sellStation.security>=0?` ${a.sellStation.security.toFixed(1)}`:a.sellStation.security.toFixed(1)}),e.jsx("span",{className:"location-text",children:a.sellStation.name})]}):"---"}),e.jsxs("div",{className:"table-cell",style:{width:200},children:[a.buyPrice?i(a.buyPrice):"---"," / ",a.sellPrice?i(a.sellPrice):"---"]}),e.jsx("div",{className:"table-cell",style:{width:150},children:i((a.sellPrice||0)*a.quantity)})]},t))})]})}),e.jsx("div",{className:"price-info",children:e.jsx("p",{children:'These numbers are from market orders at the time of appraisal. Use the "Update prices" button to create a new appraisal based on current prices.'})})]})]})]})}export{o as default};

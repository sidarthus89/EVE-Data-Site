import{j as e}from"./index-DcAEGjlW.js";import{r as t}from"./react-vendor-BmSviu0-.js";import{h as a,R as n,g as r,i,j as s}from"./common-DSNZ1I22.js";import{c as l,s as o}from"./stations-B1VLn3hK.js";const c=(e,t=2)=>{if(null==e||isNaN(e))return"0";return parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})},u={fromRegion:null,toRegion:null,nearbyOnly:!1,minProfit:"500000",maxWeight:"",minROI:4,maxJumps:"",maxBudget:"",salesTax:7.5,securityStatus:"any",structureType:"both",routePreference:"safest",hideOutOfStock:!1};function m(){const[m,d]=t.useState(u),[h,g]=t.useState(null),[p,x]=t.useState(null),[y,f]=t.useState(!1),[j,v]=t.useState([]),[b,N]=t.useState(null),[P,k]=t.useState(!1),[S,I]=t.useState([]),[R,w]=t.useState(1),[C]=t.useState(50),[T,_]=t.useState(!1),[F,B]=t.useState(!1),[O,J]=t.useState({key:null,direction:"asc"}),[M,D]=t.useState(!1),A=async e=>{try{const t=await s(`https://esi.evetech.net/latest/universe/types/${e}/`);return{volume:t.volume||.01,name:t.name||`Item ${e}`}}catch(t){return{volume:.01,name:`Item ${e}`}}},L=async(e,t)=>{try{return(await s(`https://esi.evetech.net/latest/route/${e}/${t}/`)).length-1}catch(a){return"N/A"}};t.useEffect(()=>{const e=()=>{const e=document.querySelector(".hauling-form");if(e){const t=e.getBoundingClientRect(),a=60;_(t.top<=a)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const U=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){}};t.useEffect(()=>{a().then(e=>{g(e)}).catch(e=>{N("Failed to load regions data")})},[]);const V=t.useMemo(()=>h?h.map(e=>({regionID:e.region_id||e.regionID,regionName:e.region_name||e.regionName||e.name,...e})):[],[h]);t.useEffect(()=>{m.fromRegion&&V.length,I([])},[m.fromRegion,V]),t.useEffect(()=>{m.nearbyOnly&&S.length>0?d(e=>({...e,toRegion:{regionID:"nearby",regionName:`${S.length} Nearby Regions`}})):m.nearbyOnly||"nearby"!==m.toRegion?.regionID||d(e=>({...e,toRegion:null}))},[m.nearbyOnly,S]);const $=(e,t)=>{d(a=>({...a,[e]:t||("minProfit"===e?"500000":a[e])}))},E=async(e,t,a)=>{try{const n=(await l(e,t)).filter(e=>{const t=e.profit_per_unit||e.buy_price-e.sell_price,n=e.profit_margin||t/e.sell_price*100;return t>=parseFloat(a.minProfit)&&n>=parseFloat(a.minROI)&&(!a.maxBudget||e.sell_price<=parseFloat(a.maxBudget))});return await(async(e,t)=>{const a=await i(),n=new Map(o.map(e=>[Number(e.station_id||e.stationID),e])),r=new Map(a.map(e=>[Number(e.stationID),e]));if(!e||!Array.isArray(e))return[];const s=t.maxWeight?parseFloat(t.maxWeight):null,l=[];for(const i of e){const e=await A(i.type_id);let t=i.max_volume||0;if(s&&e.volume>0){const a=Math.floor(s/e.volume);t=Math.min(t,a)}const a=Math.floor(t*e.volume),o=i.origin_id??i.from_location??i.source_station_id,c=i.destination_id??i.to_location??i.destination_station_id,u=n.get(o)||r.get(o)||{},m=n.get(c)||r.get(c)||{};u.name,m.name;const d=u.name||`Unknown Station (ID: ${o})`,h=m.name||`Unknown Station (ID: ${c})`,g="station"===u.type||1===u.is_npc,p="station"===m.type||1===m.is_npc;let x="N/A";u.system_id&&m.system_id&&(x=await L(u.system_id,m.system_id)),l.push({Item:e.name,From:{name:d,security:u.security_status??u.security??null,isNPC:g,systemId:u.system_id},To:{name:h,security:m.security_status??m.security??null,isNPC:p,systemId:m.system_id},"Buy Price":i.sell_price||0,"Sell Price":i.buy_price||0,"Profit Per Unit":i.profit_per_unit||0,"Profit Percentage":i.profit_margin||0,Quantity:t,"Total Volume (m3)":a,"Item Volume":e.volume,Jumps:x,"Total Profit":(i.profit_per_unit||0)*t,_rawData:i})}return l})(n,a)}catch(n){throw new Error("Failed to fetch market orders.")}},Q=e=>{J(t=>t.key===e?{key:e,direction:"asc"===t.direction?"desc":"asc"}:{key:e,direction:"asc"})},W=t.useMemo(()=>{if(!O.key)return j;const e=[...j];return e.sort((e,t)=>{const a=(e,t)=>{switch(t){case"Item":return e.Item||"";case"From":return e.From&&e.From.name||e.From||"";case"To":return e.To&&e.To.name||e["Take To"]||"";case"Quantity":return e.Quantity||0;case"Buy Price":return e["Buy Price"]||0;case"Total Buy Price":return(e["Buy Price"]||0)*(e.Quantity||0);case"Sell Price":return e["Sell Price"]||0;case"Net Profit":return e["Total Profit"]||0;case"Jumps":return"number"==typeof e.Jumps?e.Jumps:0;case"Profit per Jump":return"number"==typeof e.Jumps&&e["Total Profit"]?e["Total Profit"]/e.Jumps:0;case"Profit Per Item":return e["Profit Per Unit"]||0;case"ROI":return e["Profit Percentage"]||0;case"Total Volume (m³)":return e["Total Volume (m3)"]||0;default:return e[t]||""}},n=a(e,O.key),r=a(t,O.key);return"number"==typeof n&&"number"==typeof r?"asc"===O.direction?n-r:r-n:"asc"===O.direction?String(n).localeCompare(String(r)):String(r).localeCompare(String(n))}),e},[j,O]);return h?e.jsxs("div",{className:"region-hauling",children:[e.jsx("div",{className:"static-header",children:e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Region to Region Trading"}),e.jsx("p",{className:"disclaimer",children:"This feature is still a WIP and may have issues."})]})}),e.jsxs("div",{className:"scrollable-content",children:[e.jsx("div",{className:"hauling-form",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v([]),w(1),f(!0),N(null),D(!1),!m.fromRegion?.regionID||!m.toRegion?.regionID)return N("Please select both source and destination regions"),void f(!1);try{const e=Number(m.fromRegion.regionID),t=Number(m.toRegion.regionID),a=await E(e,t,m);a.length>0?(v(a),D(!0)):N("No profitable trades found for the selected criteria.")}catch(t){N(t.message)}finally{f(!1)}},children:[e.jsx("div",{className:"form-container",children:e.jsxs("div",{className:"form-row form-row-main",style:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"20px",padding:"0 20px",overflowX:"auto",margin:"0 auto 10px auto"},children:[e.jsxs("div",{className:"form-group region-group",children:[e.jsx("label",{children:"Starting Region"}),e.jsx(n,{selectedRegion:m.fromRegion,onRegionChange:e=>{d(t=>({...t,fromRegion:e,nearbyOnly:!(!t.nearbyOnly||!e)&&t.nearbyOnly}))},allowAllRegions:!1})]}),e.jsxs("div",{className:"form-group region-group",children:[e.jsx("label",{children:"Ending Region"}),m.nearbyOnly?e.jsx("div",{className:"nearby-region-display",children:"…"}):e.jsx(n,{selectedRegion:m.toRegion,onRegionChange:e=>{d(t=>({...t,toRegion:e,nearbyOnly:!1}))},allowAllRegions:!1})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Security"}),e.jsx("select",{value:m.securityStatus,onChange:e=>$("securityStatus",e.target.value),className:"form-control",style:{width:"115px"},children:[{value:"any",label:"Any"},{value:"highsec",label:"High-Sec"},{value:"lowsec",label:"Low-Sec"},{value:"nullsec",label:"Null-Sec"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stations/Structures"}),e.jsx("select",{value:m.structureType,onChange:e=>$("structureType",e.target.value),className:"form-control",style:{width:"165px"},children:[{value:"both",label:"Any"},{value:"stations",label:"NPC Stations"},{value:"structures",label:"Player Structures"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Route"}),e.jsx("select",{value:m.routePreference,onChange:e=>$("routePreference",e.target.value),className:"form-control",style:{width:"155px"},children:[{value:"safest",label:"Safest Route"},{value:"shortest",label:"Shortest Route"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Jumps"}),e.jsx("input",{type:"number",value:m.maxJumps,onChange:e=>$("maxJumps",e.target.value),placeholder:"∞",className:"form-control",style:{width:"80px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Budget"}),e.jsx("input",{type:"number",value:m.maxBudget,onChange:e=>$("maxBudget",e.target.value),placeholder:"∞",className:"form-control",style:{width:"165px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Capacity (m³)"}),e.jsx("input",{type:"number",value:m.maxWeight,onChange:e=>$("maxWeight",e.target.value),placeholder:"∞",className:"form-control",style:{width:"135px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sales Tax"}),e.jsx("select",{value:m.salesTax,onChange:e=>$("salesTax",Number(e.target.value)),className:"form-control",style:{width:"155px"},children:[{level:0,tax:7.5,label:"No Skill: 7.5%"},{level:1,tax:6.675,label:"Lvl I: 6.675%"},{level:2,tax:5.85,label:"Lvl II: 5.85%"},{level:3,tax:5.025,label:"Lvl III: 5.025%"},{level:4,tax:4.2,label:"Lvl IV: 4.2%"},{level:5,tax:3.375,label:"Lvl V: 3.375%"}].map(t=>e.jsx("option",{value:t.tax,children:t.label},t.level))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min Profit"}),e.jsx("input",{type:"number",value:m.minProfit,onChange:e=>$("minProfit",e.target.value),className:"form-control",style:{width:"175px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min ROI %"}),e.jsx("input",{type:"number",value:m.minROI,onChange:e=>$("minROI",Number(e.target.value)||0),className:"form-control",style:{width:"100px"}})]})]})}),b&&e.jsx("div",{className:"error-message",children:b}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",disabled:y||!m.fromRegion||!m.toRegion,className:"submit-btn",children:y?"Searching...":"Find Trade Routes"})})]})}),M&&W.length>0&&e.jsxs("div",{className:"results-container",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("h2",{children:["Trade Route Results (",W.length," found)"]}),P&&e.jsx("div",{className:"fallback-warning",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"4px",padding:"10px",margin:"10px 0",color:"#856404"},children:"⚠️ Azure Functions unavailable. Using basic market data analysis. Results may be limited to common trade items."}),e.jsx("button",{onClick:()=>{v([]),N(null),w(1),k(!1),D(!1)},className:"new-search-btn",children:"Clear Results"})]}),e.jsx("div",{className:"results-table-container",children:e.jsxs("table",{className:"results-table wide-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>Q("Item"),children:["Item","Item"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Quantity"),children:["Buy Quantity","Quantity"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Buy Price"),children:["Item Buy Price","Buy Price"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Total Buy Price"),children:["Total Buy Price","Total Buy Price"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("From"),children:["From","From"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("To"),children:["To","To"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Sell Price"),children:["Item Sell Price","Sell Price"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Net Profit"),children:["Net Profit","Net Profit"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Profit Per Item"),children:["Profit Per Item","Profit Per Item"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("ROI"),children:["ROI%","ROI"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Profit per Jump"),children:["Profit per Jump","Profit per Jump"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Jumps"),children:["Jumps","Jumps"===O.key?"asc"===O.direction?" ▲":" ▼":""]}),e.jsxs("th",{onClick:()=>Q("Total Volume (m³)"),children:["Total Volume (m³)","Total Volume (m³)"===O.key?"asc"===O.direction?" ▲":" ▼":""]})]})}),e.jsx("tbody",{children:(()=>{const t=(R-1)*C,a=t+C;return W.slice(t,a).map((a,n)=>{const i=a.Item||"Unknown Item",s=a.From||{},l=a.To||a["Take To"]||{},o=a["Buy Price"]||0,u=a["Sell Price"]||0,m=a["Profit Per Unit"]||0,d=a["Profit Percentage"]||0,h=a["Total Profit"]||0,g=a.Quantity||0,p=a["Total Volume (m3)"]||0,x=a.Jumps||"N/A",y=o*g,f="number"==typeof x&&x>0?h/x:0,j=t=>{if("string"==typeof t)return e.jsx("span",{className:"clickable-location",onClick:()=>U(t),title:"Click to copy to clipboard",children:t});const a=t.name||"Unknown Station",n=t.security,i=t.isNPC;let s="#ffffff";return null!=n&&(s=r(n)),e.jsx("span",{className:"clickable-location",style:{color:s},onClick:()=>U(a),title:`Security: ${null!=n?n.toFixed(1):"Unknown"} | ${i?"NPC Station":"Player Structure"} | Click to copy`,children:a})};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"clickable-location",onClick:()=>U(i),title:"Click to copy item name",children:i})}),e.jsx("td",{children:j(s)}),e.jsx("td",{children:c(g,0)}),e.jsx("td",{children:c(o)}),e.jsx("td",{children:c(y)}),e.jsx("td",{children:j(l)}),e.jsx("td",{children:c(u)}),e.jsx("td",{children:c(h)}),e.jsx("td",{children:x}),e.jsx("td",{children:c(f)}),e.jsx("td",{children:c(m)}),e.jsxs("td",{children:[c(d,1),"%"]}),e.jsx("td",{children:c(p,0)})]},t+n)})})()})]})}),W.length>C&&e.jsx("div",{className:"pagination-container",children:e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>w(e=>Math.max(e-1,1)),disabled:1===R,className:"pagination-btn",children:"Previous"}),e.jsxs("span",{className:"pagination-info",children:["Page ",R," of ",Math.ceil(W.length/C),"(",W.length," total results)"]}),e.jsx("button",{onClick:()=>w(e=>Math.min(e+1,Math.ceil(W.length/C))),disabled:R>=Math.ceil(W.length/C),className:"pagination-btn",children:"Next"})]})})]})]}),e.jsx("div",{className:"return-to-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),title:"Return to Top",children:"↑"})]}):e.jsx("div",{className:"region-hauling",children:e.jsx("div",{className:"loading-container",children:e.jsx("p",{children:"Loading regions..."})})})}export{m as default};
